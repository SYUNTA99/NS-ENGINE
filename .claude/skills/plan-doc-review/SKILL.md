---
name: plan-doc-review
description: |
  ドキュメント参照型計画の厳格レビュー。参照ドキュメント（設計書、SDK、APIリファレンス等）に基づいて作成された計画が、ドキュメントの規模・要件に見合った設計・実装になっているかを極めて厳しくレビューする。

  レビュー観点:
  - アンダーエンジニアリング検出（厳格）: 要件の見落とし、必要な考慮の欠如、簡略化しすぎ
  - API/ドキュメント一貫性（厳格）: SDKの使い方、ベストプラクティス違反、誤用
  - オーバーエンジニアリング検出（普通）: 不要な抽象化、過剰な拡張性

  使用タイミング:
  - 「計画を厳しくレビューして」「設計レビューして」「規模は適切？」で起動
  - 「厳しめにチェック」「本当にこれで大丈夫？」などの確認依頼時
  - ExitPlanMode前の最終チェックとして使用可能
---

# Strict Plan Review

ドキュメント参照型計画を極めて厳格にレビューし、規模の適切さを評価する。

## レビュー姿勢

**妥協しない。見逃さない。完璧を求める。**

- 「たぶん大丈夫」は不合格
- 疑わしきは問題として指摘
- ドキュメントに明記されていない暗黙の要件も考慮

## レビュー観点

### 1. アンダーエンジニアリング検出 [厳格]

計画がドキュメントの要件・複雑さに対して**不十分**でないかを厳しくチェック。

| チェック項目 | 問題例 |
|-------------|-------|
| 要件カバレッジ | ドキュメントの要件が計画で網羅されていない |
| エラーハンドリング | ドキュメント記載のエラーケースが考慮されていない |
| エッジケース | 境界条件、異常系の考慮不足 |
| 依存関係 | 前提条件、初期化順序の見落とし |
| リソース管理 | メモリ、ハンドル、接続の解放漏れ |
| スレッド安全性 | 並行処理の考慮が必要なのに無視 |
| バリデーション | 入力検証、状態検証の欠如 |

**判定基準（厳格）:**
- 1つでも要件の見落としがあれば CRITICAL
- エラーハンドリング不足は WARNING以上
- 「後で対応」は許容しない

### 2. API/ドキュメント一貫性 [厳格]

計画がドキュメントのAPI仕様・ベストプラクティスに**正確に従っている**かをチェック。

| チェック項目 | 問題例 |
|-------------|-------|
| API使用法 | 関数の引数順序、戻り値の扱いが間違っている |
| 推奨パターン | ドキュメント記載のベストプラクティスに従っていない |
| 非推奨API | deprecated/非推奨のAPI使用 |
| 制約違反 | ドキュメント記載の制約・注意事項の無視 |
| 型の整合性 | 型変換、キャストの誤り |
| ライフサイクル | オブジェクトの生成・破棄順序の違反 |

**判定基準（厳格）:**
- API誤用は CRITICAL
- ベストプラクティス違反は WARNING以上
- 「動くから良い」は許容しない

### 3. オーバーエンジニアリング検出 [普通]

計画が要件に対して**過剰**でないかを適度にチェック。

| チェック項目 | 問題例 |
|-------------|-------|
| 不要な抽象化 | 1箇所でしか使わないのにインターフェース化 |
| 過剰な拡張性 | 将来の要件を先取りした過度な汎用化 |
| 複雑な設計 | シンプルな要件に対して複雑すぎるアーキテクチャ |

**判定基準（普通）:**
- 明らかな過剰設計のみ WARNING
- 軽微なものは INFO または無視

## 出力フォーマット

```markdown
## 厳格レビュー結果

### 総合判定: PASS / CONDITIONAL / FAIL

| カテゴリ | 厳しさ | 判定 | 問題数 |
|---------|-------|------|-------|
| アンダーエンジニアリング | 厳格 | ○/△/× | N件 |
| API/ドキュメント一貫性 | 厳格 | ○/△/× | N件 |
| オーバーエンジニアリング | 普通 | ○/△/× | N件 |

### 問題詳細

#### [CRITICAL] 問題タイトル
- **観点**: アンダーエンジニアリング / API一貫性 / オーバーエンジニアリング
- **ドキュメント該当箇所**: 引用または参照
- **計画の問題箇所**: 該当ステップ
- **なぜ問題か**: 具体的な理由
- **修正案**: 具体的な修正内容

#### [WARNING] 問題タイトル
...

### レビュアーコメント
計画全体に対する厳しめの総評。良い点があれば簡潔に、問題点は詳細に。
```

## 総合判定基準

| 判定 | 条件 |
|-----|------|
| **PASS** | CRITICAL: 0件、WARNING: 2件以下 |
| **CONDITIONAL** | CRITICAL: 0件、WARNING: 3件以上、または INFO多数 |
| **FAIL** | CRITICAL: 1件以上 |

## レビュー実行手順

1. **計画と参照ドキュメントを特定**
   - 計画ファイル（task_plan.md等）を読み込む
   - 参照されたドキュメント（設計書、SDK docs等）を読み込む

2. **ドキュメント分析**
   - 必須要件、制約条件、API仕様を抽出
   - ベストプラクティス、注意事項を抽出
   - 暗黙の要件（エラー処理、リソース管理等）を推測

3. **計画を各観点でレビュー**
   - アンダーエンジニアリング: 厳格に、見落としを許さない
   - API一貫性: 厳格に、誤用を許さない
   - オーバーエンジニアリング: 適度に、明らかな問題のみ

4. **問題を分類・重大度判定**
   - CRITICAL: 実装失敗または仕様違反
   - WARNING: 品質・保守性に影響
   - INFO: 改善推奨

5. **総合判定と修正案を出力**
