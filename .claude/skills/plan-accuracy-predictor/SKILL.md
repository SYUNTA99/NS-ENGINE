---
name: plan-accuracy-predictor
description: プランモードで作成した計画の実装精度を予測する。ExitPlanMode前に計画の品質を評価し、実装完了時のコード品質・精度をスコアと理由で出力する。「計画の精度を予測して」「この計画で大丈夫？」「実装精度を評価して」で起動。
---

# 計画実装精度予測

プランモードで作成した計画を分析し、実装完了時のコード品質・精度を予測する。

## 評価プロセス

1. 計画ファイル（`.claude/plans/current/task_plan.md` 等）を読み込む
2. 各ステップを評価基準に照らして分析
3. ステップ別スコアと全体スコアを算出
4. 改善提案を提示

---

## 評価基準（10項目）

### 1. 具体性 (Specificity) - 15%

変更対象が明確に特定されているか。

| スコア | 基準 |
|--------|------|
| 90-100 | ファイルパス、関数名、変更行が明確。差分イメージが想像できる |
| 70-89 | ファイルパスは明確、変更内容は概要レベル |
| 50-69 | 対象モジュールは特定、具体的ファイルは曖昧 |
| 30-49 | 「〜を修正」「〜を実装」など抽象的 |
| 0-29 | 何をどこで変更するか不明 |

**サブ項目**:
- ファイルパスの明示 (0-25)
- 関数/クラス名の特定 (0-25)
- 変更内容の詳細度 (0-25)
- 期待される差分の明確さ (0-25)

---

### 2. 依存関係把握 (Dependency Awareness) - 10%

変更による影響範囲を理解しているか。

| スコア | 基準 |
|--------|------|
| 90-100 | 直接・間接の依存を列挙、影響範囲を図示 |
| 70-89 | 主要な依存関係は把握、一部未確認 |
| 50-69 | 直接の依存のみ把握、間接的影響は未考慮 |
| 30-49 | 依存関係の記述が曖昧 |
| 0-29 | 依存関係の記述なし |

**サブ項目**:
- 直接依存の特定 (0-30)
- 間接依存の特定 (0-30)
- 循環依存の考慮 (0-20)
- 影響範囲の明示 (0-20)

---

### 3. 設計品質 (Design Quality) - 12%

アーキテクチャ・設計原則への適合度。

| スコア | 基準 |
|--------|------|
| 90-100 | SOLID原則準拠、既存パターンと整合、拡張性考慮 |
| 70-89 | 主要な設計原則に従う、軽微な改善余地 |
| 50-69 | 動作はするが設計上の懸念あり |
| 30-49 | 設計原則に反する箇所あり |
| 0-29 | 設計考慮なし、スパゲッティコード予兆 |

**サブ項目**:
- 単一責任原則 (0-20)
- 依存性逆転原則 (0-20)
- 既存パターンとの整合 (0-20)
- 抽象化レベルの適切さ (0-20)
- 拡張性への配慮 (0-20)

---

### 4. 実現可能性 (Feasibility) - 10%

技術的に実現可能か、未知の要素はないか。

| スコア | 基準 |
|--------|------|
| 90-100 | 既存パターンに沿う、技術的課題なし |
| 70-89 | 軽微な調査・実験が必要 |
| 50-69 | 未検証の技術・アプローチを含む |
| 30-49 | 技術的に不明確な箇所が複数 |
| 0-29 | 技術的に矛盾、または実現困難 |

**サブ項目**:
- 技術スタックの熟知度 (0-25)
- 未検証要素の有無 (0-25)
- 外部依存のリスク (0-25)
- 制約条件の明確さ (0-25)

---

### 5. 完全性 (Completeness) - 10%

必要な要素がすべて含まれているか。

| スコア | 基準 |
|--------|------|
| 90-100 | 正常系、異常系、境界条件すべて網羅 |
| 70-89 | 主要パスは網羅、一部エッジケース未考慮 |
| 50-69 | 正常系のみ、エラー処理は後回し |
| 30-49 | 部分的な実装のみ、全体像が不明 |
| 0-29 | 断片的、何が完成状態か不明 |

**サブ項目**:
- 正常系の網羅 (0-25)
- 異常系の考慮 (0-25)
- 境界条件の考慮 (0-25)
- 前提条件の明示 (0-25)

---

### 6. エラー処理 (Error Handling) - 10%

エラー・例外への対処が計画されているか。

| スコア | 基準 |
|--------|------|
| 90-100 | 全エラーパスを列挙、回復戦略を明示 |
| 70-89 | 主要エラーは考慮、一部未定義 |
| 50-69 | 基本的なエラー処理のみ |
| 30-49 | エラー処理の記述が曖昧 |
| 0-29 | エラー処理の考慮なし |

**サブ項目**:
- エラー種別の列挙 (0-25)
- 回復戦略の明示 (0-25)
- エラーメッセージの設計 (0-25)
- ログ・診断情報の考慮 (0-25)

---

### 7. パフォーマンス考慮 (Performance) - 8%

計算量、メモリ使用量、レイテンシへの配慮。

| スコア | 基準 |
|--------|------|
| 90-100 | 計算量を明示、ボトルネック対策済み |
| 70-89 | パフォーマンス意識あり、主要箇所は最適化 |
| 50-69 | 基本的な効率性は考慮 |
| 30-49 | パフォーマンス記述が曖昧 |
| 0-29 | パフォーマンス考慮なし |

**サブ項目**:
- 計算量の見積もり (0-25)
- メモリ使用量の考慮 (0-25)
- I/O・レイテンシの考慮 (0-25)
- スケーラビリティ (0-25)

---

### 8. テスト可能性 (Testability) - 10%

テストの書きやすさ、検証方法の明確さ。

| スコア | 基準 |
|--------|------|
| 90-100 | テストケース列挙、モック戦略明示 |
| 70-89 | 主要テストシナリオを記述 |
| 50-69 | テスト対象は明確、具体的ケースは未定 |
| 30-49 | テストの記述が曖昧 |
| 0-29 | テスト考慮なし |

**サブ項目**:
- ユニットテスト設計 (0-25)
- 統合テスト設計 (0-25)
- モック/スタブ戦略 (0-25)
- 検証方法の明確さ (0-25)

---

### 9. 保守性 (Maintainability) - 8%

将来の変更・拡張のしやすさ。

| スコア | 基準 |
|--------|------|
| 90-100 | 変更容易、影響範囲限定、ドキュメント計画あり |
| 70-89 | 保守性を意識、一部改善余地 |
| 50-69 | 現状では問題なし、将来の拡張性は未考慮 |
| 30-49 | 保守しにくい構造になる予兆 |
| 0-29 | 技術的負債の増加が予想される |

**サブ項目**:
- コードの可読性 (0-25)
- モジュール性 (0-25)
- ドキュメント計画 (0-25)
- 変更影響の局所化 (0-25)

---

### 10. コードスタイル準拠 (Style Compliance) - 7%

プロジェクト規約・命名規則への適合。

| スコア | 基準 |
|--------|------|
| 90-100 | CLAUDE.md規約を明示的に参照、完全準拠 |
| 70-89 | 主要規約に準拠、軽微な逸脱可能性 |
| 50-69 | 基本的な規約は意識 |
| 30-49 | 規約への言及が曖昧 |
| 0-29 | 規約考慮なし |

**サブ項目**:
- 命名規則の準拠 (0-30)
- ファイル構成の準拠 (0-30)
- コメント規約の準拠 (0-20)
- namespace規約の準拠 (0-20)

---

## 出力フォーマット

```
## 実装精度予測

### 全体スコア: XX/100

**総評**: [2-3文で全体評価]

### カテゴリ別スコア

| カテゴリ | スコア | 重み | 寄与 |
|----------|--------|------|------|
| 具体性 | XX | 15% | XX |
| 依存関係把握 | XX | 10% | XX |
| 設計品質 | XX | 12% | XX |
| 実現可能性 | XX | 10% | XX |
| 完全性 | XX | 10% | XX |
| エラー処理 | XX | 10% | XX |
| パフォーマンス | XX | 8% | XX |
| テスト可能性 | XX | 10% | XX |
| 保守性 | XX | 8% | XX |
| スタイル準拠 | XX | 7% | XX |

### ステップ別評価

| ステップ | スコア | 最大リスク項目 |
|----------|--------|----------------|
| 1. [名前] | XX/100 | [項目名: 理由] |
| 2. [名前] | XX/100 | [項目名: 理由] |
| ... | ... | ... |

### 低スコア項目の詳細 (60未満)

#### [項目名] (XX/100)

**サブ項目内訳**:
- [サブ項目1]: XX/25 - [理由]
- [サブ項目2]: XX/25 - [理由]
- ...

**影響**: [この低スコアが実装に与える影響]

### 改善提案

#### 優先度: 高
1. [具体的な改善アクション] → 予想スコア向上: +XX

#### 優先度: 中
2. [具体的な改善アクション] → 予想スコア向上: +XX

#### 優先度: 低
3. [具体的な改善アクション] → 予想スコア向上: +XX
```

---

## スコア解釈ガイド

| 全体スコア | 解釈 | 推奨アクション |
|------------|------|----------------|
| 90-100 | 高精度で実装可能 | 承認して実装開始 |
| 80-89 | 良好、軽微な調整で実装可能 | 指摘箇所を確認後、承認 |
| 70-79 | 概ね良好、一部リスクあり | 低スコア項目を改善後、再評価 |
| 60-69 | 一部不明確、追加調査が必要 | 計画を補強してから承認 |
| 50-59 | リスクが高い、計画の見直し推奨 | 計画を大幅に修正 |
| 0-49 | 計画として不十分 | 計画を再作成 |

---

## リスクフラグ

以下の条件に該当する場合、スコアに関わらず警告を出力:

| フラグ | 条件 | 警告メッセージ |
|--------|------|----------------|
| 🔴 CRITICAL | 設計品質 < 50 または 実現可能性 < 50 | 「根本的な設計見直しが必要」 |
| 🟠 HIGH | エラー処理 < 40 または テスト可能性 < 40 | 「品質保証に懸念あり」 |
| 🟡 MEDIUM | 依存関係把握 < 50 | 「影響範囲の再調査を推奨」 |
| 🔵 LOW | スタイル準拠 < 50 | 「規約違反の可能性」 |

---

## 注意事項

- このスキルは予測であり、実装結果を保証するものではない
- 外部API、未知のライブラリ等、調査不足の領域は低く評価される
- 計画の改善後、再度予測を実行して比較可能
- サブ項目スコアは参考値、最終判断はカテゴリスコアで行う
