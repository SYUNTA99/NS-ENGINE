---
description: "HLSL ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¤œè¨¼"
model: haiku
allowed-tools:
  - "Bash(fxc:*)"
  - "Bash(where:*)"
  - "Grep"
  - "Read"
  - "Glob"
---

# Shader Compiler Check

HLSLã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¤œè¨¼ã¨å‹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã¾ã™ã€‚

## ä½¿ç”¨æ–¹æ³•

`/shader-compiler-check [shader_path]`

- å¼•æ•°ãªã—: `assets/shader/*.hlsl` å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œè¨¼
- ãƒ‘ã‚¹æŒ‡å®š: ç‰¹å®šã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ã¿æ¤œè¨¼

ä¾‹:
- `/shader-compiler-check` â†’ å…¨ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼
- `/shader-compiler-check assets/shader/mesh_vs.hlsl` â†’ ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«
- `/shader-compiler-check mesh_vs` â†’ ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ

## æ¤œè¨¼é …ç›®

### 1. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¤œè¨¼ï¼ˆfxc.exeï¼‰

ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚¿ã‚¤ãƒ—ã‚’è‡ªå‹•åˆ¤å®š:
- `*_vs.hlsl` â†’ é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ (`vs_5_0`)
- `*_ps.hlsl` â†’ ãƒ”ã‚¯ã‚»ãƒ«ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ (`ps_5_0`)
- `*_gs.hlsl` â†’ ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ (`gs_5_0`)
- `*_cs.hlsl` â†’ ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ (`cs_5_0`)

### 2. è¡Œåˆ—è»¢ç½®ãƒã‚§ãƒƒã‚¯

**è­¦å‘Šå¯¾è±¡:**
- `row_major` ä¿®é£¾å­ã®ä½¿ç”¨ï¼ˆéæ¨å¥¨ï¼‰
- C++å´ã§ `Transpose()` å‘¼ã³å‡ºã—æ¼ã‚Œã®å¯èƒ½æ€§

**CLAUDE.mdè¦ç´„:**
```
HLSLã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§column-majorã€C++ã¯ row-majorã€‚
C++å´ã§è»¢ç½®ã—ã¦ã‹ã‚‰ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«é€ã‚‹ã€‚
```

### 3. å®šæ•°ãƒãƒƒãƒ•ã‚¡å‹ãƒã‚§ãƒƒã‚¯

C++ã®å®šæ•°ãƒãƒƒãƒ•ã‚¡æ§‹é€ ä½“ã¨HLSLã®`cbuffer`ã‚’æ¯”è¼ƒ:
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é †åº
- å‹ã‚µã‚¤ã‚º
- ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°

## å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

### fxc.exe ã®å ´æ‰€ã‚’ç¢ºèª

```bash
where fxc.exe 2>nul || echo "C:\Program Files (x86)\Windows Kits\10\bin\10.0.22621.0\x64\fxc.exe"
```

### ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆä¾‹: é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ï¼‰

```bash
"C:\Program Files (x86)\Windows Kits\10\bin\10.0.22621.0\x64\fxc.exe" /T vs_5_0 /E main /nologo /Zi "assets\shader\mesh_vs.hlsl" 2>&1
```

### ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆä¾‹: ãƒ”ã‚¯ã‚»ãƒ«ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ï¼‰

```bash
"C:\Program Files (x86)\Windows Kits\10\bin\10.0.22621.0\x64\fxc.exe" /T ps_5_0 /E main /nologo /Zi "assets\shader\mesh_ps.hlsl" 2>&1
```

## ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” SHADER COMPILER CHECK
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ Target: assets/shader/*.hlsl (12 files)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Shader                    â”‚ Profile â”‚ Status    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mesh_vs.hlsl             â”‚ vs_5_0  â”‚ âœ“ OK      â”‚
â”‚ mesh_ps.hlsl             â”‚ ps_5_0  â”‚ âœ“ OK      â”‚
â”‚ sprite_vs.hlsl           â”‚ vs_5_0  â”‚ âœ“ OK      â”‚
â”‚ sprite_ps.hlsl           â”‚ ps_5_0  â”‚ âš  Warning â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ WARNINGS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

sprite_ps.hlsl:23: warning X4000: ...
  â†’ [è­¦å‘Šã®èª¬æ˜ã¨å¯¾å‡¦æ³•]

ğŸ”§ MATRIX CONVENTION CHECK
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ“ No `row_major` declarations found (using column-major default)
âœ“ C++ transpose pattern detected in shader_manager.cpp

ğŸ“ CBUFFER ALIGNMENT CHECK
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

mesh_vs.hlsl cbuffer CameraBuffer:
  â”œâ”€ float4x4 viewProjection  @ offset 0  (64 bytes)
  â”œâ”€ float4x4 world           @ offset 64 (64 bytes)
  â””â”€ Total: 128 bytes âœ“

Matching C++ struct: MeshConstantBuffer (mesh_batch.h:42)
  âœ“ Layout matches

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

## ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦

| ã‚¨ãƒ©ãƒ¼ | åŸå›  | å¯¾å‡¦ |
|--------|------|------|
| `error X3000: syntax error` | HLSLæ§‹æ–‡ã‚¨ãƒ©ãƒ¼ | ã‚¨ãƒ©ãƒ¼è¡Œã‚’ç¢ºèª |
| `error X3004: undeclared identifier` | æœªå®šç¾©å¤‰æ•° | å®£è¨€ã‚’è¿½åŠ  |
| `error X4502: cannot have input/output semantic` | ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ä¸ä¸€è‡´ | å…¥å‡ºåŠ›æ§‹é€ ä½“ã‚’ç¢ºèª |
| `warning X3206: implicit truncation` | å‹å¤‰æ›è­¦å‘Š | æ˜ç¤ºçš„ã‚­ãƒ£ã‚¹ãƒˆ |

## æ³¨æ„äº‹é …

- **fxc.exe**ã¯Windows SDK ã«å«ã¾ã‚Œã‚‹ï¼ˆVisual Studio ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«å°å…¥ï¼‰
- **ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ**ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `main`ï¼ˆç•°ãªã‚‹å ´åˆã¯ `/E` ã§æŒ‡å®šï¼‰
- **ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ãƒ‘ã‚¹**ãŒå¿…è¦ãªå ´åˆã¯ `/I` ã§è¿½åŠ 
