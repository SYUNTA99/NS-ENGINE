# RHI 実装ガイド Part 2: コマンドとリソース

## 目次

1. [コマンドコンテキスト実装](#1-コマンドコンテキスト実装)
2. [コマンドリスト/アロケーター](#2-コマンドリストアロケーター)
3. [Buffer 実装](#3-buffer-実装)
4. [Texture 実装](#4-texture-実装)
5. [View 実装](#5-view-実装)

---

## 1. コマンドコンテキスト実装

### 1.1 コンテキスト階層

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      コンテキスト クラス階層                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                   IRHIComputeContext                                    │
│                   (RHI/Public/RHIContext.h)                             │
│                   │                                                     │
│                   │ 継承                                                │
│                   ▼                                                     │
│                   IRHICommandContext                                    │
│                   (RHI/Public/RHIContext.h)                             │
│                   │                                                     │
│   ────────────────┼────────────────────────                             │
│   │               │                                                     │
│   ▼               ▼                                                     │
│ FYourContextCommon   FYourContextCopy                                   │
│ (コマンド記録基盤)    (コピー専用)                                        │
│   │                                                                     │
│   │ 継承                                                                │
│   ▼                                                                     │
│ FYourCommandContext                                                     │
│ (Graphics + Compute)                                                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 FYourContextCommon の責務

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   FYourContextCommon の責務                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【コマンドリスト管理】                                                   │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ライフサイクル:                                                   │   │
│  │ ・OpenCommandList()   : コマンドリストを開く                     │   │
│  │ ・CloseCommandList()  : コマンドリストを閉じる                   │   │
│  │ ・OpenIfNotAlready()  : 開いていなければ開く                     │   │
│  │                                                                   │   │
│  │ 状態:                                                             │   │
│  │ ・IsOpen()            : 開いているか                             │   │
│  │ ・IsPendingCommands() : ペンディングコマンドがあるか             │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【ペイロード管理】                                                      │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ペイロード:                                                       │   │
│  │ ・記録中のコマンドリスト群をまとめたもの                          │   │
│  │ ・同期ポイント、クエリ情報を含む                                  │   │
│  │                                                                   │   │
│  │ フェーズ:                                                         │   │
│  │ ・Wait                    : 同期待ち                              │   │
│  │ ・UpdateReservedResources : 予約リソース更新                      │   │
│  │ ・Execute                 : コマンド実行                          │   │
│  │ ・Signal                  : シグナル                              │   │
│  │                                                                   │   │
│  │ GetPayload(Phase):                                                │   │
│  │ ・現在のフェーズに応じたペイロードを返す                          │   │
│  │ ・フェーズが戻る場合は新しいペイロードを作成                      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【同期ポイント管理】                                                    │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ SyncPoint操作:                                                    │   │
│  │ ・SignalSyncPoint()   : 同期ポイントをシグナル                   │   │
│  │ ・WaitSyncPoint()     : 同期ポイントを待機                       │   │
│  │ ・SignalManualFence() : 手動フェンスをシグナル                   │   │
│  │ ・WaitManualFence()   : 手動フェンスを待機                       │   │
│  │                                                                   │   │
│  │ BatchedSyncPoints:                                                │   │
│  │ ・ToWait   : バッチ開始時に待つ同期ポイント                      │   │
│  │ ・ToSignal : バッチ終了時にシグナルする同期ポイント              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【クエリ管理】                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ クエリアロケーター:                                               │   │
│  │ ・TimestampQueries     : タイムスタンプクエリ                    │   │
│  │ ・OcclusionQueries     : オクルージョンクエリ                    │   │
│  │ ・PipelineStatsQueries : パイプライン統計クエリ                  │   │
│  │                                                                   │   │
│  │ 操作:                                                             │   │
│  │ ・InsertTimestamp()    : タイムスタンプ挿入                      │   │
│  │ ・AllocateQuery()      : クエリ割り当て                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【バリア管理】                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ・Barriers : ペンディングバリアの管理                             │   │
│  │ ・リソース状態遷移のバッチ処理                                    │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【終了処理】                                                            │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ・Finalize()     : ペイロードを完成させて返す                     │   │
│  │ ・FlushCommands(): コマンドをGPUに送信                           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.3 FYourCommandContext の責務

```
┌─────────────────────────────────────────────────────────────────────────┐
│                  FYourCommandContext の責務                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【IRHIComputeContext 実装】コンピュート機能                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ パイプライン設定:                                                 │   │
│  │ ・RHISetComputePipelineState(ComputePSO)                         │   │
│  │   └─ コンピュートパイプラインをバインド                          │   │
│  │                                                                   │   │
│  │ ディスパッチ:                                                     │   │
│  │ ・RHIDispatchComputeShader(X, Y, Z)                              │   │
│  │   └─ スレッドグループ数を指定してディスパッチ                    │   │
│  │ ・RHIDispatchIndirectComputeShader(Buffer, Offset)               │   │
│  │   └─ バッファから引数を読んで間接ディスパッチ                    │   │
│  │                                                                   │   │
│  │ UAVクリア:                                                        │   │
│  │ ・RHIClearUAVFloat(UAV, Values)                                  │   │
│  │ ・RHIClearUAVUint(UAV, Values)                                   │   │
│  │                                                                   │   │
│  │ リソース遷移:                                                     │   │
│  │ ・RHIBeginTransitions(Transitions[])                             │   │
│  │ ・RHIEndTransitions(Transitions[])                               │   │
│  │                                                                   │   │
│  │ シェーダーパラメータ:                                             │   │
│  │ ・RHISetShaderParameters(Shader, Data, Params, Resources, ...)   │   │
│  │ ・RHISetStaticUniformBuffers(Bindings)                           │   │
│  │ ・RHISetStaticUniformBuffer(Slot, Buffer)                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【IRHICommandContext 実装】グラフィックス機能                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ パイプライン設定:                                                 │   │
│  │ ・RHISetGraphicsPipelineState(GraphicsPSO, StencilRef)           │   │
│  │   └─ グラフィックスパイプラインをバインド                        │   │
│  │                                                                   │   │
│  │ レンダーパス:                                                     │   │
│  │ ・RHIBeginRenderPass(RenderPassInfo, Name)                       │   │
│  │   └─ レンダーターゲット設定、クリア処理                          │   │
│  │ ・RHIEndRenderPass()                                             │   │
│  │   └─ レンダーパス終了、Resolve処理                               │   │
│  │ ・RHINextSubpass()                                               │   │
│  │   └─ 次のサブパスへ（モバイル向け最適化）                        │   │
│  │                                                                   │   │
│  │ ビューポート/シザー:                                              │   │
│  │ ・RHISetViewport(MinX, MinY, MinZ, MaxX, MaxY, MaxZ)             │   │
│  │ ・RHISetScissorRect(Enable, MinX, MinY, MaxX, MaxY)              │   │
│  │                                                                   │   │
│  │ 頂点入力:                                                         │   │
│  │ ・RHISetStreamSource(StreamIndex, VertexBuffer, Offset)          │   │
│  │   └─ 頂点バッファをスロットにバインド                            │   │
│  │                                                                   │   │
│  │ 描画コマンド:                                                     │   │
│  │ ・RHIDrawPrimitive(BaseVertex, NumPrims, NumInstances)           │   │
│  │ ・RHIDrawIndexedPrimitive(IndexBuffer, BaseVertex, FirstInst,    │   │
│  │                           NumVerts, StartIndex, NumPrims, NumInst)│   │
│  │ ・RHIDrawPrimitiveIndirect(ArgBuffer, Offset)                    │   │
│  │ ・RHIDrawIndexedIndirect(IndexBuf, ArgBuf, DrawIndex, NumInst)   │   │
│  │                                                                   │   │
│  │ コピー:                                                           │   │
│  │ ・RHICopyTexture(Src, Dst, CopyInfo)                             │   │
│  │ ・RHICopyBufferRegion(DstBuf, DstOff, SrcBuf, SrcOff, Size)      │   │
│  │                                                                   │   │
│  │ デバッグ:                                                         │   │
│  │ ・RHIPushEvent(Name, Color)                                      │   │
│  │ ・RHIPopEvent()                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【ステートキャッシュ】                                                   │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ StateCache:                                                       │   │
│  │ ・現在バインドされているリソースを追跡                            │   │
│  │ ・冗長なAPI呼び出しを防止                                         │   │
│  │ ・Dirty フラグで変更を追跡                                        │   │
│  │                                                                   │   │
│  │ キャッシュ対象:                                                   │   │
│  │ ・現在のPSO                                                       │   │
│  │ ・頂点バッファバインディング                                      │   │
│  │ ・シェーダーリソースバインディング                                │   │
│  │ ・サンプラーバインディング                                        │   │
│  │ ・定数バッファバインディング                                      │   │
│  │ ・レンダーターゲット                                              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.4 RHIBeginRenderPass の処理詳細

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   RHIBeginRenderPass() の処理                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  入力: FRHIRenderPassInfo                                               │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ColorRenderTargets[8]:                                            │   │
│  │   ├─ RenderTarget    : FRHITexture*                              │   │
│  │   ├─ ResolveTarget   : FRHITexture* (MSAA解決先)                 │   │
│  │   ├─ ArraySlice      : int32                                     │   │
│  │   ├─ MipIndex        : uint8                                     │   │
│  │   ├─ Action          : Load/Clear/NoAction/ENoAction             │   │
│  │   └─ StoreAction     : Store/Resolve/NoAction                    │   │
│  │                                                                   │   │
│  │ DepthStencilRenderTarget:                                         │   │
│  │   ├─ DepthStencilTarget : FRHITexture*                           │   │
│  │   ├─ DepthAction / StencilAction                                 │   │
│  │   ├─ DepthStoreAction / StencilStoreAction                       │   │
│  │   └─ ExclusiveDepthStencil                                       │   │
│  │                                                                   │   │
│  │ その他:                                                           │   │
│  │   ├─ NumOcclusionQueries                                         │   │
│  │   ├─ bOcclusionQueries                                           │   │
│  │   └─ SubpassHint                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  処理フロー:                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 1. バリア挿入                                                     │   │
│  │    ・カラーRT: SRV/UAV → RenderTarget 状態へ                     │   │
│  │    ・深度:     SRV → DepthWrite/DepthRead 状態へ                 │   │
│  │                                                                   │   │
│  │ 2. レンダーターゲット設定                                         │   │
│  │    ・RTV/DSVをコマンドリストに設定                                │   │
│  │    ・OMSetRenderTargets() 相当                                   │   │
│  │                                                                   │   │
│  │ 3. クリア処理 (Action == Clear の場合)                           │   │
│  │    ・ClearRenderTargetView()                                     │   │
│  │    ・ClearDepthStencilView()                                     │   │
│  │                                                                   │   │
│  │ 4. オクルージョンクエリ開始 (指定時)                              │   │
│  │                                                                   │   │
│  │ 5. 内部状態更新                                                   │   │
│  │    ・bInsideRenderPass = true                                    │   │
│  │    ・CurrentRenderPassInfo保存                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.5 描画コマンドの処理

```
┌─────────────────────────────────────────────────────────────────────────┐
│                  RHIDrawIndexedPrimitive() の処理                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  入力パラメータ:                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ・IndexBuffer       : インデックスバッファ                        │   │
│  │ ・BaseVertexIndex   : 頂点オフセット                              │   │
│  │ ・FirstInstance     : 最初のインスタンスID                        │   │
│  │ ・NumVertices       : 頂点数（使用されない場合あり）              │   │
│  │ ・StartIndex        : 開始インデックス                            │   │
│  │ ・NumPrimitives     : プリミティブ数                              │   │
│  │ ・NumInstances      : インスタンス数                              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  処理フロー:                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 1. 事前チェック                                                   │   │
│  │    ・bInsideRenderPass == true を確認                            │   │
│  │    ・PSO がバインドされていることを確認                           │   │
│  │                                                                   │   │
│  │ 2. ステートキャッシュの適用                                       │   │
│  │    ・Dirty フラグをチェック                                       │   │
│  │    ・変更があればAPI呼び出し                                      │   │
│  │      - デスクリプタテーブル設定                                   │   │
│  │      - 定数バッファ設定                                           │   │
│  │      - 頂点バッファ設定                                           │   │
│  │                                                                   │   │
│  │ 3. インデックスバッファ設定                                       │   │
│  │    ・IASetIndexBuffer() 相当                                     │   │
│  │                                                                   │   │
│  │ 4. インデックス数計算                                             │   │
│  │    ・NumIndices = GetVertexCountForPrimitiveCount(               │   │
│  │                      NumPrimitives, PrimitiveType)               │   │
│  │                                                                   │   │
│  │ 5. 描画コマンド発行                                               │   │
│  │    ・DrawIndexedInstanced(NumIndices, NumInstances,              │   │
│  │                          StartIndex, BaseVertexIndex,            │   │
│  │                          FirstInstance)                          │   │
│  │                                                                   │   │
│  │ 6. 統計更新                                                       │   │
│  │    ・DrawCall数                                                   │   │
│  │    ・プリミティブ数                                               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. コマンドリスト/アロケーター

### 2.1 コマンドアロケーターの役割

```
┌─────────────────────────────────────────────────────────────────────────┐
│                  コマンドアロケーター の概念                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【コマンドアロケーターとは】                                            │
│  ・コマンドリストに記録されるコマンドのメモリを管理                      │
│  ・GPU がコマンドを実行中は再利用不可                                    │
│  ・GPU 完了後にリセットして再利用                                        │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                   │   │
│  │    CPU                                GPU                         │   │
│  │    ─────                              ───                         │   │
│  │                                                                   │   │
│  │  ┌──────────────┐                                                │   │
│  │  │ Allocator A  │ ─Record─▶ ┌─────────┐                         │   │
│  │  │ (使用中)      │           │CmdList 1│ ─Execute─▶ [GPU実行中]   │   │
│  │  └──────────────┘           └─────────┘                         │   │
│  │         │                                     │                   │   │
│  │         │ ※GPU実行中は再利用不可              │                   │   │
│  │         │                                     ▼                   │   │
│  │         │                              [GPU完了シグナル]          │   │
│  │         │                                     │                   │   │
│  │         ▼                                     │                   │   │
│  │  ┌──────────────┐                             │                   │   │
│  │  │ Allocator A  │ ◀──────── Reset ────────────┘                   │   │
│  │  │ (再利用可能)  │                                                │   │
│  │  └──────────────┘                                                │   │
│  │                                                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【プール管理】                                                          │
│  ・複数のアロケーターをプールで管理                                      │
│  ・ObtainCommandAllocator() : 使用可能なものを取得                      │
│  ・ReleaseCommandAllocator(): GPU完了後にプールへ返却                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 コマンドリストの役割

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    コマンドリスト の概念                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【コマンドリストとは】                                                   │
│  ・GPU コマンドを記録するオブジェクト                                    │
│  ・記録 → 閉じる → 実行 のライフサイクル                                │
│  ・閉じた後は再利用可能（別のアロケーターで）                            │
│                                                                         │
│  【ライフサイクル】                                                      │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                   │   │
│  │  ┌─────────┐    Reset     ┌─────────┐                           │   │
│  │  │ Initial │ ──────────▶ │Recording│                           │   │
│  │  └─────────┘              └────┬────┘                           │   │
│  │       ▲                        │                                 │   │
│  │       │                        │ Close                           │   │
│  │       │                        ▼                                 │   │
│  │       │                   ┌─────────┐                           │   │
│  │       │                   │ Closed  │                           │   │
│  │       │                   └────┬────┘                           │   │
│  │       │                        │                                 │   │
│  │       │ Reset                  │ Execute                         │   │
│  │       │                        ▼                                 │   │
│  │       │                   ┌─────────┐                           │   │
│  │       └───────────────────│Executed │                           │   │
│  │           (GPU完了後)      └─────────┘                           │   │
│  │                                                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【タイプ別機能】                                                        │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ Direct (Graphics):                                                │   │
│  │   ・全コマンド使用可能                                            │   │
│  │   ・描画、コンピュート、コピー                                    │   │
│  │                                                                   │   │
│  │ Compute:                                                          │   │
│  │   ・コンピュートとコピーのみ                                      │   │
│  │   ・描画コマンド不可                                              │   │
│  │                                                                   │   │
│  │ Copy:                                                             │   │
│  │   ・コピーコマンドのみ                                            │   │
│  │   ・描画、コンピュート不可                                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.3 FYourCommandList の構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   FYourCommandList メンバー構成                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FYourCommandList                                                       │
│  │                                                                      │
│  ├── NativeCommandList : YourNativeCommandList*                         │
│  │    └── ネイティブコマンドリストオブジェクト                          │
│  │                                                                      │
│  ├── CommandListType : EYourCommandListType                             │
│  │    └── Direct / Compute / Copy                                       │
│  │                                                                      │
│  ├── CurrentAllocator : FYourCommandAllocator*                          │
│  │    └── 現在使用中のアロケーター                                      │
│  │                                                                      │
│  ├── State : ECommandListState                                          │
│  │    └── Initial / Recording / Closed / Executed                       │
│  │                                                                      │
│  ├── NumCommands : uint32                                               │
│  │    └── 記録されたコマンド数（推定）                                   │
│  │                                                                      │
│  └── [デバッグ情報]                                                      │
│       ├── DebugName                                                     │
│       └── CreationCallstack (デバッグビルド時)                          │
│                                                                         │
│  【主要メソッド】                                                        │
│  ├── Open(Allocator)     : 記録開始                                     │
│  ├── Close()             : 記録終了                                     │
│  ├── Reset(Allocator)    : リセットして再利用                           │
│  │                                                                      │
│  ├── BaseCommandList()   : 基底コマンドリスト取得                       │
│  ├── CopyCommandList()   : コピー用インターフェース取得                 │
│  └── GraphicsCommandList(): グラフィックス用インターフェース取得        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Buffer 実装

### 3.1 Buffer の種類と用途

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      バッファの種類と用途                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【EBufferUsageFlags による分類】                                        │
│                                                                         │
│  ┌─────────────────┬───────────────────────────────────────────────┐   │
│  │ フラグ          │ 説明                                          │   │
│  ├─────────────────┼───────────────────────────────────────────────┤   │
│  │ VertexBuffer    │ 頂点データ格納                                │   │
│  │                 │ IASetVertexBuffers で使用                     │   │
│  ├─────────────────┼───────────────────────────────────────────────┤   │
│  │ IndexBuffer     │ インデックスデータ格納                        │   │
│  │                 │ IASetIndexBuffer で使用                       │   │
│  ├─────────────────┼───────────────────────────────────────────────┤   │
│  │ StructuredBuffer│ 構造化バッファ (要素サイズ固定)               │   │
│  │                 │ SRV/UAV でシェーダーアクセス                  │   │
│  ├─────────────────┼───────────────────────────────────────────────┤   │
│  │ ByteAddressBuffer│Raw バッファ (バイト単位アクセス)             │   │
│  │                 │ SRV/UAV でシェーダーアクセス                  │   │
│  ├─────────────────┼───────────────────────────────────────────────┤   │
│  │ IndirectArguments│間接描画/ディスパッチ引数                     │   │
│  │                 │ ExecuteIndirect で使用                        │   │
│  ├─────────────────┼───────────────────────────────────────────────┤   │
│  │ UnorderedAccess │ UAV アクセス可能                              │   │
│  │                 │ シェーダーから読み書き                        │   │
│  ├─────────────────┼───────────────────────────────────────────────┤   │
│  │ ShaderResource  │ SRV アクセス可能                              │   │
│  │                 │ シェーダーから読み取り                        │   │
│  ├─────────────────┼───────────────────────────────────────────────┤   │
│  │ KeepCPUAccessible│CPU からアクセス可能                          │   │
│  │                 │ Map/Unmap 可能                                │   │
│  └─────────────────┴───────────────────────────────────────────────┘   │
│                                                                         │
│  【メモリタイプとの関係】                                                │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                   │   │
│  │  用途                    │ メモリタイプ │ アクセス              │   │
│  │  ────────────────────────┼──────────────┼───────────────────    │   │
│  │  頻繁にGPU読み取り       │ DEFAULT      │ GPU のみ              │   │
│  │  毎フレームCPU更新       │ UPLOAD       │ CPU書き込み→GPU読み  │   │
│  │  GPUからCPUへ読み戻し    │ READBACK     │ GPU書き込み→CPU読み  │   │
│  │                                                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 FYourBuffer の構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     FYourBuffer メンバー構成                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FYourBuffer : public FRHIBuffer, public FYourBaseShaderResource        │
│  │                                                                      │
│  ├── [継承: FRHIBuffer]                                                 │
│  │    ├── Size   : バッファサイズ (バイト)                              │
│  │    ├── Stride : 要素ストライド                                       │
│  │    └── Usage  : EBufferUsageFlags                                    │
│  │                                                                      │
│  ├── ResourceLocation : FYourResourceLocation                           │
│  │    │  └── 実際のGPUメモリ位置を示す                                  │
│  │    │                                                                 │
│  │    ├── Resource : FYourResource*                                     │
│  │    │    └── 基盤リソースへの参照                                     │
│  │    ├── Offset : uint64                                               │
│  │    │    └── リソース内オフセット（サブアロケーション時）              │
│  │    ├── Size : uint64                                                 │
│  │    │    └── 割り当てサイズ                                           │
│  │    └── GPUVirtualAddress : YourGPUAddress                            │
│  │         └── GPU 仮想アドレス                                         │
│  │                                                                      │
│  ├── LockedData : FYourLockedResource                                   │
│  │    └── Lock 中のデータ情報                                           │
│  │                                                                      │
│  └── LinkedObjects : (マルチGPU時)                                       │
│       └── 各GPUノードのリンクリスト                                      │
│                                                                         │
│  【主要メソッド】                                                        │
│  ├── GetNativeResource()     : ネイティブリソース取得                   │
│  ├── GetGPUVirtualAddress()  : GPU アドレス取得                         │
│  ├── Lock(Offset, Size, Mode): CPU アクセス用ロック                     │
│  └── Unlock()                : ロック解除                               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 バッファ作成フロー

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      バッファ作成の流れ                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  RHICreateBufferInitializer(RHICmdList, CreateDesc)                     │
│    │                                                                    │
│    ├─1─▶ 作成パラメータ解析                                             │
│    │      ・Size, Stride, Usage フラグ確認                              │
│    │      ・初期データ有無確認                                          │
│    │                                                                    │
│    ├─2─▶ メモリタイプ決定                                               │
│    │      ┌─────────────────────────────────────────────────────┐      │
│    │      │ Dynamic + KeepCPUAccessible → UPLOAD               │      │
│    │      │ 上記以外                     → DEFAULT             │      │
│    │      └─────────────────────────────────────────────────────┘      │
│    │                                                                    │
│    ├─3─▶ リソース割り当て方法決定                                        │
│    │      ┌─────────────────────────────────────────────────────┐      │
│    │      │ 小さいバッファ → サブアロケーション（プールから）    │      │
│    │      │ 大きいバッファ → Committed Resource（専用割り当て）  │      │
│    │      └─────────────────────────────────────────────────────┘      │
│    │                                                                    │
│    ├─4─▶ GPUリソース作成                                                │
│    │      ・CreateCommittedResource() または                           │
│    │      ・CreatePlacedResource()                                     │
│    │                                                                    │
│    ├─5─▶ FYourBuffer オブジェクト作成                                    │
│    │      ・ResourceLocation設定                                        │
│    │      ・マルチGPU時はリンクオブジェクト作成                          │
│    │                                                                    │
│    └─6─▶ 初期データアップロード（あれば）                                │
│           ・アップロードヒープ経由でコピー                               │
│           ・またはMap/Unmapで直接書き込み                               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.4 バッファ Lock/Unlock

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      Lock/Unlock の仕組み                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【Lock モード】                                                         │
│  ┌─────────────────┬───────────────────────────────────────────────┐   │
│  │ RLM_ReadOnly    │ 読み取り専用（READBACK リソース）             │   │
│  │ RLM_WriteOnly   │ 書き込み専用（UPLOAD リソース、既存破棄）     │   │
│  │ RLM_WriteOnly_NoOverwrite │ 書き込み（既存データ維持）         │   │
│  └─────────────────┴───────────────────────────────────────────────┘   │
│                                                                         │
│  【DEFAULT リソースの場合】                                               │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                   │   │
│  │  Lock(WriteOnly)                                                 │   │
│  │    │                                                             │   │
│  │    ├─▶ ステージングバッファ（UPLOAD）を確保                      │   │
│  │    │                                                             │   │
│  │    └─▶ ステージングバッファのアドレスを返す                      │   │
│  │                                                                   │   │
│  │  [ユーザーがデータを書き込み]                                     │   │
│  │                                                                   │   │
│  │  Unlock()                                                        │   │
│  │    │                                                             │   │
│  │    ├─▶ CopyBufferRegion コマンド発行                             │   │
│  │    │     (UPLOAD → DEFAULT)                                      │   │
│  │    │                                                             │   │
│  │    └─▶ ステージングバッファを遅延解放キューへ                    │   │
│  │                                                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【UPLOAD リソースの場合】                                               │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                   │   │
│  │  Lock(WriteOnly)                                                 │   │
│  │    │                                                             │   │
│  │    └─▶ Resource->Map() を呼び出し                                │   │
│  │        直接マップされたアドレスを返す                            │   │
│  │                                                                   │   │
│  │  Unlock()                                                        │   │
│  │    │                                                             │   │
│  │    └─▶ Resource->Unmap() を呼び出し                              │   │
│  │        ※コピー不要（同じメモリ）                                 │   │
│  │                                                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Texture 実装

### 4.1 テクスチャの種類

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      テクスチャの種類                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【ETextureDimension による分類】                                        │
│                                                                         │
│  ┌──────────────┬─────────────────────────────────────────────────┐    │
│  │ Texture2D    │  ┌─────────────┐                                │    │
│  │              │  │             │ Width x Height                 │    │
│  │              │  │   2D画像    │ + MipLevels                    │    │
│  │              │  │             │                                │    │
│  │              │  └─────────────┘                                │    │
│  ├──────────────┼─────────────────────────────────────────────────┤    │
│  │ Texture2D    │  ┌─────┐┌─────┐┌─────┐                         │    │
│  │ Array        │  │  0  ││  1  ││  2  │...  ArraySize枚の2D     │    │
│  │              │  └─────┘└─────┘└─────┘                         │    │
│  ├──────────────┼─────────────────────────────────────────────────┤    │
│  │ Texture3D    │  ┌─────────────┐                                │    │
│  │ (Volume)     │  │ ┌─────────┐ │ Width x Height x Depth        │    │
│  │              │  │ │  3D     │ │ + MipLevels                    │    │
│  │              │  │ └─────────┘ │                                │    │
│  │              │  └─────────────┘                                │    │
│  ├──────────────┼─────────────────────────────────────────────────┤    │
│  │ TextureCube  │      ┌───┐                                      │    │
│  │              │    ┌─┴───┴─┐    6面のキューブマップ             │    │
│  │              │    │ +X-X │    (各面 Width x Width)            │    │
│  │              │    │ +Y-Y │    + MipLevels                     │    │
│  │              │    │ +Z-Z │                                     │    │
│  │              │    └───────┘                                    │    │
│  ├──────────────┼─────────────────────────────────────────────────┤    │
│  │ TextureCube  │  キューブマップの配列                           │    │
│  │ Array        │  ArraySize 個のキューブマップ                   │    │
│  └──────────────┴─────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 テクスチャフラグ

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    ETextureCreateFlags 主要フラグ                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【レンダリング関連】                                                    │
│  ┌─────────────────────┬───────────────────────────────────────────┐   │
│  │ RenderTargetable    │ レンダーターゲットとして使用可能          │   │
│  │ DepthStencilTargetable │ 深度ステンシルとして使用可能          │   │
│  │ ResolveTargetable   │ MSAA解決先として使用可能                 │   │
│  │ ShaderResource      │ SRV として使用可能                       │   │
│  │ UAV                 │ UAV として使用可能                       │   │
│  └─────────────────────┴───────────────────────────────────────────┘   │
│                                                                         │
│  【メモリ関連】                                                          │
│  ┌─────────────────────┬───────────────────────────────────────────┐   │
│  │ CPUReadback         │ CPU読み戻し用（Staging）                  │   │
│  │ CPUWritable         │ CPU書き込み用                             │   │
│  │ Streamable          │ ストリーミング対応                        │   │
│  │ Virtual             │ 仮想テクスチャ                            │   │
│  │ NoTiling            │ タイリング無効（リニアレイアウト）        │   │
│  └─────────────────────┴───────────────────────────────────────────┘   │
│                                                                         │
│  【マルチサンプル関連】                                                  │
│  ┌─────────────────────┬───────────────────────────────────────────┐   │
│  │ NumSamples > 1      │ MSAA テクスチャ                           │   │
│  └─────────────────────┴───────────────────────────────────────────┘   │
│                                                                         │
│  【その他】                                                              │
│  ┌─────────────────────┬───────────────────────────────────────────┐   │
│  │ SRGB                │ sRGB カラースペース                       │   │
│  │ NoFastClear         │ 高速クリア無効                            │   │
│  │ Presentable         │ 画面表示用（スワップチェーン）            │   │
│  │ Shared              │ プロセス間共有                            │   │
│  └─────────────────────┴───────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.3 FYourTexture の構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    FYourTexture メンバー構成                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FYourTexture : public FRHITexture, public FYourBaseShaderResource      │
│  │                                                                      │
│  ├── [継承: FRHITexture から Desc取得可能]                               │
│  │    ├── Dimension : ETextureDimension                                 │
│  │    ├── Extent    : FIntVector (Width, Height, Depth/ArraySize)       │
│  │    ├── Format    : EPixelFormat                                      │
│  │    ├── NumMips   : uint8                                             │
│  │    ├── NumSamples: uint8                                             │
│  │    └── Flags     : ETextureCreateFlags                               │
│  │                                                                      │
│  ├── [継承: FYourBaseShaderResource]                                    │
│  │    └── ResourceLocation : FYourResourceLocation                      │
│  │                                                                      │
│  ├── ShaderResourceView : TSharedPtr<FYourShaderResourceView>           │
│  │    └── デフォルトSRV（全Mip、全Array）                               │
│  │                                                                      │
│  ├── RenderTargetViews : TArray<TSharedPtr<FYourRenderTargetView>>      │
│  │    └── レンダーターゲットビュー（Mip/Slice別）                       │
│  │                                                                      │
│  ├── DepthStencilViews[MaxIndex]                                        │
│  │    └── 深度ステンシルビュー（アクセスタイプ別）                       │
│  │        [0] ReadWrite                                                 │
│  │        [1] DepthRead_StencilWrite                                    │
│  │        [2] DepthWrite_StencilRead                                    │
│  │        [3] ReadOnly                                                  │
│  │                                                                      │
│  ├── LockedMap : TMap<uint32, TUniquePtr<FYourLockedResource>>          │
│  │    └── ロック中のサブリソース情報                                    │
│  │                                                                      │
│  ├── bCreatedRTVsPerSlice : bool                                        │
│  │    └── スライスごとにRTV作成したか                                   │
│  │                                                                      │
│  └── AliasingSourceTexture : FTextureRHIRef                             │
│       └── エイリアシング元テクスチャ                                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.4 テクスチャ作成フロー

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     テクスチャ作成の流れ                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  RHICreateTextureInitializer(RHICmdList, CreateDesc)                    │
│    │                                                                    │
│    ├─1─▶ 作成パラメータ解析                                             │
│    │      ・Dimension, Extent, Format, NumMips, Flags                   │
│    │      ・ClearValue (レンダーターゲット時)                            │
│    │                                                                    │
│    ├─2─▶ ネイティブフォーマット決定                                      │
│    │      ・EPixelFormat → NativeFormat 変換                            │
│    │      ・Typeless フォーマット判定                                    │
│    │      ・圧縮フォーマット対応                                        │
│    │                                                                    │
│    ├─3─▶ リソース記述子作成                                             │
│    │      ・Width, Height, DepthOrArraySize                             │
│    │      ・MipLevels, SampleDesc                                       │
│    │      ・Flags (RTV, DSV, UAV, SRV)                                  │
│    │                                                                    │
│    ├─4─▶ リソース配置決定                                               │
│    │      ┌─────────────────────────────────────────────────────┐      │
│    │      │ 小さいテクスチャ → Placed (テクスチャプールから)    │      │
│    │      │ 大きいテクスチャ → Committed (専用割り当て)         │      │
│    │      │ レンダーターゲット → Committed (通常)              │      │
│    │      └─────────────────────────────────────────────────────┘      │
│    │                                                                    │
│    ├─5─▶ GPUリソース作成                                                │
│    │      ・CreateCommittedResource() または                           │
│    │      ・CreatePlacedResource()                                     │
│    │                                                                    │
│    ├─6─▶ FYourTexture オブジェクト作成                                   │
│    │                                                                    │
│    ├─7─▶ ビュー作成                                                     │
│    │      ・CreateViews() 呼び出し                                      │
│    │        ├─ SRV 作成（ShaderResource フラグ時）                     │
│    │        ├─ RTV 作成（RenderTargetable フラグ時）                   │
│    │        └─ DSV 作成（DepthStencilTargetable フラグ時）             │
│    │                                                                    │
│    └─8─▶ 初期データアップロード（あれば）                                │
│           ・アップロードヒープ経由でコピー                               │
│           ・Mipレベルごとにコピー                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. View 実装

### 5.1 ビューの概念

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        ビューとは                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【ビューの役割】                                                        │
│  ・リソース（テクスチャ/バッファ）の「見方」を定義                       │
│  ・同じリソースから複数の異なるビューを作成可能                          │
│  ・シェーダーやパイプラインステージごとに適切なビューを使用              │
│                                                                         │
│  【ビュー種別】                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                   │   │
│  │  SRV (ShaderResourceView)                                        │   │
│  │  ├─ 用途: シェーダーからの読み取り                               │   │
│  │  ├─ 対象: テクスチャ、バッファ                                   │   │
│  │  └─ 例: テクスチャサンプリング、構造化バッファ読み取り           │   │
│  │                                                                   │   │
│  │  UAV (UnorderedAccessView)                                       │   │
│  │  ├─ 用途: シェーダーからの読み書き                               │   │
│  │  ├─ 対象: テクスチャ、バッファ                                   │   │
│  │  └─ 例: コンピュートシェーダー出力、アトミック操作               │   │
│  │                                                                   │   │
│  │  RTV (RenderTargetView)                                          │   │
│  │  ├─ 用途: レンダーターゲットとして書き込み                       │   │
│  │  ├─ 対象: テクスチャのみ                                         │   │
│  │  └─ 例: カラーバッファ出力                                       │   │
│  │                                                                   │   │
│  │  DSV (DepthStencilView)                                          │   │
│  │  ├─ 用途: 深度/ステンシルバッファとして使用                      │   │
│  │  ├─ 対象: 深度フォーマットテクスチャのみ                         │   │
│  │  └─ 例: 深度テスト、ステンシルテスト                             │   │
│  │                                                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.2 ビューのサブリソース指定

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    サブリソースの指定方法                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【テクスチャのサブリソース】                                            │
│                                                                         │
│     ArraySlice 0      ArraySlice 1      ArraySlice 2                    │
│    ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                 │
│    │ Mip 0       │   │ Mip 0       │   │ Mip 0       │                 │
│    │ (1024x1024) │   │             │   │             │                 │
│    ├─────────────┤   ├─────────────┤   ├─────────────┤                 │
│    │ Mip 1       │   │ Mip 1       │   │ Mip 1       │                 │
│    │ (512x512)   │   │             │   │             │                 │
│    ├─────────────┤   ├─────────────┤   ├─────────────┤                 │
│    │ Mip 2       │   │ Mip 2       │   │ Mip 2       │                 │
│    │ (256x256)   │   │             │   │             │                 │
│    └─────────────┘   └─────────────┘   └─────────────┘                 │
│                                                                         │
│    SubresourceIndex = MipSlice + (ArraySlice * MipLevels)               │
│                                                                         │
│  【SRV でのサブリソース指定例】                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 全Mip、全Array:                                                   │   │
│  │   MostDetailedMip = 0                                            │   │
│  │   MipLevels = -1 (全て)                                          │   │
│  │   FirstArraySlice = 0                                            │   │
│  │   ArraySize = -1 (全て)                                          │   │
│  │                                                                   │   │
│  │ 特定Mipのみ:                                                      │   │
│  │   MostDetailedMip = 2                                            │   │
│  │   MipLevels = 1                                                  │   │
│  │                                                                   │   │
│  │ 特定Arrayスライスのみ:                                            │   │
│  │   FirstArraySlice = 1                                            │   │
│  │   ArraySize = 1                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  【RTV でのサブリソース指定例】                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 通常は単一Mip、単一Sliceを指定:                                   │   │
│  │   MipSlice = 0                                                   │   │
│  │   FirstArraySlice = 0                                            │   │
│  │   ArraySize = 1                                                  │   │
│  │                                                                   │   │
│  │ ジオメトリシェーダーで複数レイヤー出力:                           │   │
│  │   MipSlice = 0                                                   │   │
│  │   FirstArraySlice = 0                                            │   │
│  │   ArraySize = 6  (キューブマップ全面等)                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.3 各ビュークラスの構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    FYourShaderResourceView                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FYourShaderResourceView : public FRHIShaderResourceView                │
│  │                                                                      │
│  ├── DescriptorHandle : YourCPUDescriptorHandle                         │
│  │    └── デスクリプタヒープ内のハンドル                                │
│  │                                                                      │
│  ├── Resource : FYourViewableResource*                                  │
│  │    └── ビュー対象のリソース                                          │
│  │                                                                      │
│  ├── ViewDesc : YourSRVDesc                                             │
│  │    └── ビュー作成時の記述子                                          │
│  │                                                                      │
│  └── BindlessHandle : FRHIDescriptorHandle (Bindless時)                 │
│       └── Bindless デスクリプタハンドル                                 │
│                                                                         │
│  【CreateView メソッドの処理】                                           │
│  1. デスクリプタ割り当て（OfflineDescriptorManagerから）                │
│  2. CreateShaderResourceView API 呼び出し                               │
│  3. Bindless時は追加でBindlessハンドル割り当て                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                    FYourUnorderedAccessView                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FYourUnorderedAccessView : public FRHIUnorderedAccessView              │
│  │                                                                      │
│  ├── DescriptorHandle : YourCPUDescriptorHandle                         │
│  ├── Resource : FYourViewableResource*                                  │
│  ├── ViewDesc : YourUAVDesc                                             │
│  ├── CounterResource : FYourResource* (カウンタ付きバッファ時)          │
│  └── BindlessHandle : FRHIDescriptorHandle                              │
│                                                                         │
│  【特記事項】                                                            │
│  ・カウンタ付き構造化バッファの場合、別途カウンタリソースが必要         │
│  ・ClearUAV 操作時はビューのフォーマットに注意                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                    FYourRenderTargetView                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FYourRenderTargetView                                                  │
│  │                                                                      │
│  ├── DescriptorHandle : YourCPUDescriptorHandle                         │
│  ├── Texture : FYourTexture*                                            │
│  ├── ViewDesc : YourRTVDesc                                             │
│  │    ├── Format                                                        │
│  │    ├── ViewDimension (2D, 2DArray, 3D, ...)                         │
│  │    ├── MipSlice                                                      │
│  │    ├── FirstArraySlice                                               │
│  │    └── ArraySize                                                     │
│  └── LinkedObject : FYourRenderTargetView* (マルチGPU時)                │
│                                                                         │
│  【特記事項】                                                            │
│  ・MSAAテクスチャの場合は ViewDimension = 2DMS                          │
│  ・3Dテクスチャの場合は WSlice を指定                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                    FYourDepthStencilView                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FYourDepthStencilView                                                  │
│  │                                                                      │
│  ├── DescriptorHandle : YourCPUDescriptorHandle                         │
│  ├── Texture : FYourTexture*                                            │
│  ├── ViewDesc : YourDSVDesc                                             │
│  │    ├── Format                                                        │
│  │    ├── ViewDimension                                                 │
│  │    ├── Flags (ReadOnlyDepth, ReadOnlyStencil)                       │
│  │    └── MipSlice                                                      │
│  └── AccessType : FExclusiveDepthStencil                                │
│                                                                         │
│  【アクセスタイプ】                                                      │
│  ┌───────────────────────┬────────────────────────────────────────┐    │
│  │ DepthWrite_StencilWrite │ 両方書き込み可能（通常の深度テスト） │    │
│  │ DepthRead_StencilWrite  │ 深度読み取り専用                     │    │
│  │ DepthWrite_StencilRead  │ ステンシル読み取り専用               │    │
│  │ DepthRead_StencilRead   │ 両方読み取り専用（深度をSRVで使用時）│    │
│  └───────────────────────┴────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 次のパートの内容

Part 3 では以下を解説します：
- シェーダー実装
- パイプラインステート実装
- 同期/フェンス実装
- デスクリプタ管理
- メモリアロケーション詳細
