# 00-04: パフォーマンス予算

## 目的

RHI全体の横断的なパフォーマンス予算を定義する。各サブ計画の設計判断の根拠となる数値基準。

## CPU時間予算 (フレーム16.6ms中)

| 操作 | 予算 | 根拠 |
|------|------|------|
| ディスクリプタ割り当て (フレーム全体) | < 0.5ms | 10-02: リングバッファO(1) |
| バリアバッチ発行 (1回) | < 0.1ms | 16-02: 最大64バリア/バッチ |
| PSO作成 (キャッシュヒット) | < 0.01ms | 07-05: ハッシュルックアップ |
| PSO作成 (キャッシュミス) | < 50ms | 07-05: GPU編集、非同期許容 |
| コマンドリスト記録 (1リスト) | < 2ms | 02-01: 軽量仮想関数 |
| アップロードヒープ転送 (フレーム全体) | < 1ms CPU | 11-04: 64MB/フレーム |

## メモリ予算

| リソース | 予算 | 根拠 |
|----------|------|------|
| CBV/SRV/UAVディスクリプタヒープ | 1M個 | 10-02: Bindless対応 |
| サンプラーディスクリプタヒープ | 2048個 | D3D12上限 |
| アップロードヒープ | 64MB | 11-04: デフォルト |
| 定数バッファプール | 16MB | 11-02: デフォルト |
| バリアバッチ容量 | 64個/バッチ | 16-02 |
| スプリットバリア同時保持 | 16個 | 16-02 |

## 計測方法

- RHICommandListStats (25-01) でフレーム統計
- RHIGPUProfiler (05-06) でGPU時間
- RHIMemoryStats (25-02) でメモリ使用量

## 予算超過時の対応

1. **警告**: デバッグビルドでフレーム予算超過時にログ警告を出力
2. **統計収集**: 超過頻度と超過量を RHICommandListStats に記録
3. **適応**: アップロードヒープ・ディスクリプタヒープは動的拡張可能（00-02 回復戦略参照）
