# Unreal Engine 5.7 プラットフォーム抽象化レイヤー (HAL) 完全解説

## 第10部：コアユーティリティ・非同期システム詳細

---

## 目次

1. [文字列・テキストユーティリティ](#セクション-1-文字列テキストユーティリティ)
2. [メモリアライメントユーティリティ](#セクション-2-メモリアライメントユーティリティ)
3. [ハッシュ関数](#セクション-3-ハッシュ関数)
4. [スタックアロケーション](#セクション-4-スタックアロケーション)
5. [国際化システム](#セクション-5-国際化システム)
6. [コンテナアロケータポリシー](#セクション-6-コンテナアロケータポリシー)
7. [コンテナ成長定数](#セクション-7-コンテナ成長定数)
8. [ハッシュテーブル・Set定数](#セクション-8-ハッシュテーブルset定数)
9. [SparseArray・BitArray実装](#セクション-9-sparsearraybitarray実装)
10. [非同期タスクシステム](#セクション-10-非同期タスクシステム)
11. [スレッドプールシステム](#セクション-11-スレッドプールシステム)
12. [タスクグラフシステム](#セクション-12-タスクグラフシステム)
13. [ParallelForシステム](#セクション-13-parallelforシステム)
14. [低レベルスレッディングプリミティブ](#セクション-14-低レベルスレッディングプリミティブ)

---

## セクション 1: 文字列・テキストユーティリティ

### FChar 文字定数

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      FChar 文字定数                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【制御文字定数】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  LineFeed           = 0x0A   // 改行 (LF)                         │ │
│  │  VerticalTab        = 0x0B   // 垂直タブ                          │ │
│  │  FormFeed           = 0x0C   // フォームフィード                  │ │
│  │  CarriageReturn     = 0x0D   // キャリッジリターン (CR)           │ │
│  │  NextLine           = 0x85   // 次行 (WIDECHAR)                   │ │
│  │  LineSeparator      = 0x2028 // 行区切り (WIDECHAR)               │ │
│  │  ParagraphSeparator = 0x2029 // 段落区切り (WIDECHAR)             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【文字分類メソッド】                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  ToUpper(Char)      // ASCII 大文字変換                           │ │
│  │  ToLower(Char)      // ASCII 小文字変換                           │ │
│  │  IsUpper()          // 大文字判定                                 │ │
│  │  IsLower()          // 小文字判定                                 │ │
│  │  IsAlpha()          // アルファベット判定                         │ │
│  │  IsDigit()          // 数字判定                                   │ │
│  │  IsHexDigit()       // 16進数字判定                               │ │
│  │  IsOctDigit()       // 8進数字判定                                │ │
│  │  IsWhitespace()     // 空白文字判定                               │ │
│  │  IsControl()        // 制御文字判定                               │ │
│  │  IsAlnum()          // 英数字判定                                 │ │
│  │  IsGraph()          // グラフ文字判定                             │ │
│  │  IsPrint()          // 印刷可能文字判定                           │ │
│  │  IsPunct()          // 句読点判定                                 │ │
│  │  IsIdentifier()     // 識別子文字判定                             │ │
│  │  IsUnderscore()     // アンダースコア判定                         │ │
│  │  ConvertCharDigitToInt(Char) → int32  // 数字→整数変換            │ │
│  │  ToUnsigned(Char) → uint32            // 安全な算術用変換         │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【型定義】                                                             │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FChar      = TChar<TCHAR>      // プラットフォーム文字           │ │
│  │  FCharWide  = TChar<WIDECHAR>   // ワイド文字                     │ │
│  │  FCharAnsi  = TChar<ANSICHAR>   // ANSI 文字                      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### ESearchCase / ESearchDir 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   検索オプション列挙型                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【ESearchCase::Type】                                                  │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  CaseSensitive   // 大文字小文字を区別                            │ │
│  │  IgnoreCase      // 大文字小文字を無視                            │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【ESearchDir::Type】                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FromStart       // 先頭から検索                                  │ │
│  │  FromEnd         // 末尾から検索                                  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### UE::String 名前空間ユーティリティ

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   UE::String ユーティリティ                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【BytesToHex 関数】                                                    │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  BytesToHex(Bytes, OutHex)       // 大文字16進数変換              │ │
│  │  BytesToHexLower(Bytes, OutHex)  // 小文字16進数変換              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【Split 関数】                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  SplitFirst(View, Search, OutLeft, OutRight, Case)                │ │
│  │  SplitLast(View, Search, OutLeft, OutRight, Case)                 │ │
│  │  SplitFirstOfAny(View, SearchArray, OutLeft, OutRight, ...)       │ │
│  │  SplitLastOfAny(View, SearchArray, OutLeft, OutRight, ...)        │ │
│  │  SplitFirstChar(View, Char, OutLeft, OutRight, Case)              │ │
│  │  SplitLastChar(View, Char, OutLeft, OutRight, Case)               │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【Find 関数】                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FindFirst(View, Search, Case) → int32                            │ │
│  │  FindLast(View, Search, Case) → int32                             │ │
│  │  FindFirstOfAny(View, SearchArray, Case, OutIndex) → int32        │ │
│  │  FindLastOfAny(View, SearchArray, Case, OutIndex) → int32         │ │
│  │  FindFirstChar(View, Char, Case) → int32                          │ │
│  │  FindLastChar(View, Char, Case) → int32                           │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【LexFromString 関数】                                                 │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  LexFromString(int8/16/32/64&, StringView)   // 整数パース        │ │
│  │  LexFromString(uint8/16/32/64&, StringView)  // 符号なし整数      │ │
│  │  LexFromString(float/double&, StringView)    // 浮動小数点        │ │
│  │  LexFromString(bool&, StringView)            // ブール値          │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 2: メモリアライメントユーティリティ

### TTypeCompatibleBytes テンプレート

```
┌─────────────────────────────────────────────────────────────────────────┐
│                  TTypeCompatibleBytes テンプレート                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  template<typename ElementType>                                        │
│  struct TTypeCompatibleBytes                                           │
│                                                                         │
│  【ストレージ】                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  alignas(ElementType) uint8 Pad[sizeof(ElementType)]              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【型エイリアス】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  MutableGetType  = ElementType&        // 非const左辺値           │ │
│  │  ConstGetType    = const ElementType&  // const左辺値             │ │
│  │  RvalueGetType   = ElementType&&       // 右辺値                  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【メソッド】                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  GetTypedPtr() → ElementType*         // 型付きポインタ取得       │ │
│  │  GetUnchecked() & → ElementType&      // 未チェック参照取得       │ │
│  │  EmplaceUnchecked(Args...) → void     // インプレース構築         │ │
│  │  DestroyUnchecked() → void            // デストラクタ呼び出し     │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### TAlignedBytes テンプレート

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    TAlignedBytes テンプレート                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  template<int32 Size, uint32 Alignment>                                │
│  struct TAlignedBytes                                                  │
│  {                                                                     │
│      alignas(Alignment) uint8 Pad[Size];                               │
│  };                                                                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### アライメント関数テンプレート

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    アライメント関数テンプレート                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【アライメント関数】                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Align(Val, Alignment)         // 上方向アライメント (2のべき乗)  │ │
│  │  AlignDown(Val, Alignment)     // 下方向アライメント (2のべき乗)  │ │
│  │  IsAligned(Val, Alignment)     // アライメントチェック            │ │
│  │  AlignArbitrary(Val, Alignment) // 任意値アライメント             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  ※ 整数型とポインタ型のみサポート                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 3: ハッシュ関数

### FGuid 構造体

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         FGuid 構造体                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【コンポーネント】                                                     │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  uint32 A, B, C, D   // 128ビット GUID を4つの32ビット値で表現    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【生成メソッド】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  NewGuid()                         // 新規ランダム GUID           │ │
│  │  NewDeterministicGuid(Path, Seed)  // 決定論的 GUID               │ │
│  │  NewGuidFromHash(Blake3Hash)       // Blake3 ハッシュから生成     │ │
│  │  NewGuidFromHashBytes(Data, Len)   // バイト列から生成            │ │
│  │  Combine(GuidA, GuidB)             // 2つの GUID を結合           │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【フォーマット (EGuidFormats)】                                        │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Digits                       // "00000000000000000000000000000000"│
│  │  DigitsLower                  // 小文字16進数                     │ │
│  │  DigitsWithHyphens            // "00000000-0000-0000-0000-..."    │ │
│  │  DigitsWithHyphensLower       // 小文字ハイフン付き               │ │
│  │  DigitsWithHyphensInBraces    // "{00000000-0000-...}"            │ │
│  │  DigitsWithHyphensInParentheses // "(00000000-0000-...)"          │ │
│  │  HexValuesInBraces            // "{0x00000000,0x0000,...}"        │ │
│  │  UniqueObjectGuid             // "00000000-00000000-00000000-..." │ │
│  │  Short                        // Base64 (ダッシュ/アンダースコア) │ │
│  │  Base36Encoded                // "1DPF6ARFCM4XH5RMWPU8TGR0J"      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FCrc 構造体

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         FCrc 構造体                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【ルックアップテーブル】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  CRCTablesSB8[8][256]   // Slicing by 8 実装用テーブル            │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【CRC 生成メソッド】                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  MemCrc32(Data, Length, CRC=0) → uint32    // メモリ CRC32        │ │
│  │  TypeCrc32(Data, CRC=0) → uint32           // 型の CRC32          │ │
│  │  StrCrc32(Data, CRC=0) → uint32            // 文字列 CRC32        │ │
│  │  StrCrc32Len(Data, Length, CRC=0) → uint32 // 長さ指定文字列      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FNV ハッシュ

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         FNV ハッシュ                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【定数】                                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FNV-1a 32-bit:                                                   │ │
│  │    Offset = 0x811c9dc5                                            │ │
│  │    Prime  = 0x01000193                                            │ │
│  │                                                                   │ │
│  │  FNV-1a 64-bit:                                                   │ │
│  │    Offset = 0xcbf29ce484222325                                    │ │
│  │    Prime  = 0x100000001b3                                         │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【FFnv メソッド】                                                      │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  MemFnv32(Data, Length, FNV=0) → uint32                           │ │
│  │  MemFnv64(Data, Length, FNV=0) → uint64                           │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【UE:: constexpr 関数】                                                │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  HashStringFNV1a<HashType>(StringView) → HashType                 │ │
│  │  HashStringFNV1a32(StringView) → uint32                           │ │
│  │  HashStringFNV1a64(StringView) → uint64                           │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FBlake3 ハッシュ

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        FBlake3 ハッシュ                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【FBlake3Hash 構造体】                                                 │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  ByteArray = uint8[32]   // 32バイト (256ビット) ハッシュ値       │ │
│  │                                                                   │ │
│  │  メソッド:                                                        │ │
│  │   Reset()           // ゼロにリセット                             │ │
│  │   IsZero()          // ゼロ判定                                   │ │
│  │   GetBytes()        // バイト配列取得                             │ │
│  │   FromView(Hash)    // 32バイトビューから構築                     │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【FBlake3 クラス】                                                     │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  HasherBytes サイズ: 1912 バイト (alignas(8))                     │ │
│  │                                                                   │ │
│  │  メソッド:                                                        │ │
│  │   Reset()                      // ハッシャーリセット              │ │
│  │   Update(View/Data/Buffer)     // データ追加                      │ │
│  │   Finalize() → FBlake3Hash     // ハッシュ確定                    │ │
│  │                                                                   │ │
│  │  静的メソッド:                                                    │ │
│  │   HashBuffer(View/Data/Buffer) → FBlake3Hash  // 一括ハッシュ     │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### CityHash

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         CityHash                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【関数】                                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  CityHash64(buf, len) → uint64                                    │ │
│  │  CityHash64WithSeed(buf, len, seed) → uint64                      │ │
│  │  CityHash64WithSeeds(buf, len, seed0, seed1) → uint64             │ │
│  │  CityHash32(buf, len) → uint32                                    │ │
│  │  CityHash128to64(Uint128_64) → uint64                             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【Uint128_64 構造体】                                                  │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  uint64 lo   // 下位64ビット                                      │ │
│  │  uint64 hi   // 上位64ビット                                      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  ※ レガシー - 新コードは XXHash 推奨                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 4: スタックアロケーション

### FMemStackBase クラス

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      FMemStackBase クラス                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【EPageSize 列挙型】                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Small   // デフォルト、割り当てが大きければ大きなページを使用    │ │
│  │  Large   // 常に大きなページを割り当て                            │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【ページサイズ定数】                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  PageSize      = 64 * 1024       // 64 KB (FPageAllocator)        │ │
│  │  SmallPageSize = 1024 - 16       // 1008 バイト (ヘッダー分差引)  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【メソッド】                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  PushBytes(AllocSize, Alignment) → uint8*  // バイト確保          │ │
│  │  CanFitInPage(AllocSize, Alignment) → bool // ページに収まるか    │ │
│  │  Alloc(AllocSize, Alignment) → void*       // 割り当て            │ │
│  │  GetTop() → uint8*                         // スタック先頭取得    │ │
│  │  IsEmpty() → bool                          // 空判定              │ │
│  │  Flush()                                   // 全解放              │ │
│  │  GetNumMarks() → int32                     // マーク数取得        │ │
│  │  GetByteCount() → int32                    // 使用バイト数        │ │
│  │  ContainsPointer(Pointer) → bool           // ポインタ所属判定    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【初期化列挙型】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  EMemZeroed { MEM_Zeroed = 1 }   // ゼロ初期化                    │ │
│  │  EMemOned   { MEM_Oned = 1 }     // 0xFF 初期化                   │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FMemMark クラス

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        FMemMark クラス                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【用途】                                                               │
│  スタックアロケータの特定位置をマークし、                              │
│  デストラクタまたは Pop() で一括解放                                   │
│                                                                         │
│  【コンストラクタ/デストラクタ】                                        │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FMemMark(FMemStackBase& InMem)  // マーク位置を記録              │ │
│  │  ~FMemMark()                     // マーク以降のメモリを解放      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【メソッド】                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Pop()   // マーク作成後に割り当てられたメモリを解放              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【内部状態】                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FMemStackBase& Mem                // 参照先スタック              │ │
│  │  uint8* Top                        // マーク時のスタック先頭      │ │
│  │  FTaggedMemory* SavedChunk         // マーク時のチャンク          │ │
│  │  bool bPopped                      // 既に Pop 済みフラグ         │ │
│  │  FMemMark* NextTopmostMark         // マーク連鎖                  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### スタックアロケーション用 operator new

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   スタックアロケーション演算子                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【テンプレート関数】                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  New<T>(Mem, Count=1, Align=DEFAULT)     → T*    // 通常割り当て  │ │
│  │  NewZeroed<T>(Mem, Count=1, Align=DEFAULT) → T*  // ゼロ初期化    │ │
│  │  NewOned<T>(Mem, Count=1, Align=DEFAULT)  → T*   // 0xFF 初期化   │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【placement new オーバーロード】                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  operator new(Size, Mem, Count=1)                                 │ │
│  │  operator new(Size, align_val_t, Mem, Count=1)    // C++17        │ │
│  │  operator new(Size, Mem, EMemZeroed, Count=1)     // ゼロ初期化   │ │
│  │  operator new(Size, Mem, EMemOned, Count=1)       // 0xFF 初期化  │ │
│  │  operator new[](...)                              // 配列版       │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 5: 国際化システム

### ETextFlag 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      ETextFlag 列挙型                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Transient              = 1 << 0   // 一時的テキスト                   │
│  CultureInvariant       = 1 << 1   // カルチャ非依存                   │
│  ConvertedProperty      = 1 << 2   // プロパティ変換済み               │
│  Immutable              = 1 << 3   // 不変テキスト                     │
│  InitializedFromString  = 1 << 4   // 文字列から初期化                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### ETextPluralType / ETextPluralForm 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   複数形・性別列挙型                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【ETextPluralType】                                                    │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Cardinal   // 基数詞 (1, 2, 3...)                                │ │
│  │  Ordinal    // 序数詞 (1st, 2nd, 3rd...)                          │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【ETextPluralForm】                                                    │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Zero   = 0   // ゼロ                                             │ │
│  │  One    = 1   // 単数形                                           │ │
│  │  Two    = 2   // 双数形                                           │ │
│  │  Few    = 3   // 少数形 (Paucal)                                  │ │
│  │  Many   = 4   // 多数形 (分数含む)                                │ │
│  │  Other  = 5   // 一般複数形                                       │ │
│  │  Count  = 6   // エントリ数                                       │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【ETextGender】                                                        │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Masculine   // 男性形                                            │ │
│  │  Feminine    // 女性形                                            │ │
│  │  Neuter      // 中性形                                            │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### EDateTimeStyle 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    EDateTimeStyle 列挙型                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Default   = 0   // デフォルト                                         │
│  Short     = 1   // 短形式                                             │
│  Medium    = 2   // 中形式                                             │
│  Long      = 3   // 長形式                                             │
│  Full      = 4   // 完全形式                                           │
│  Custom    = 5   // カスタム (内部使用のみ)                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FCulture クラス

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        FCulture クラス                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【識別子タイプ (ECultureIdentifierType)】                              │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  UE     // "en-US" (ハイフン区切り)                               │ │
│  │  Verse  // "en_US" (アンダースコア区切り)                         │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【名前・識別子メソッド】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  GetDisplayName()                  → const FString&               │ │
│  │  GetEnglishName()                  → const FString&               │ │
│  │  GetName()                         → const FString&  // "en-US"   │ │
│  │  GetVerseIdentifier()              → const FString&  // "en_US"   │ │
│  │  GetNativeName()                   → const FString&               │ │
│  │  GetThreeLetterISOLanguageName()   → const FString&               │ │
│  │  GetTwoLetterISOLanguageName()     → const FString&               │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【ロケール情報】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  GetKeyboardLayoutId() → int                                      │ │
│  │  GetLCID() → int                                                  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【静的変換メソッド】                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  CultureNameToVerseIdentifier(Name) → FString  // "en-US"→"en_US"│ │
│  │  CultureNameFromVerseIdentifier(Id) → FString  // "en_US"→"en-US"│ │
│  │  CreateCultureName(Lang, Script, Region) → FString                │ │
│  │  GetCanonicalName(Name) → FString                                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FInternationalization クラス

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   FInternationalization クラス                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【シングルトンアクセス】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Get() → FInternationalization&    // インスタンス取得            │ │
│  │  IsAvailable() → bool              // 利用可能判定                │ │
│  │  TearDown()                        // シャットダウン              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【カルチャ設定】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  SetCurrentCulture(Name) → bool     // 言語+ロケール一括設定      │ │
│  │  SetCurrentLanguage(Name) → bool    // ローカライズ用言語のみ     │ │
│  │  SetCurrentLocale(Name) → bool      // i18n 用ロケールのみ        │ │
│  │  SetCurrentLanguageAndLocale(Name) → bool                         │ │
│  │  SetCurrentAssetGroupCulture(Group, Name) → bool                  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【カルチャ取得】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  GetCurrentCulture() → FCultureRef                                │ │
│  │  GetCurrentLanguage() → FCultureRef                               │ │
│  │  GetCurrentLocale() → FCultureRef                                 │ │
│  │  GetCurrentAssetGroupCulture(Group) → FCultureRef                 │ │
│  │  GetDefaultCulture() → FCultureRef                                │ │
│  │  GetInvariantCulture() → FCultureRef                              │ │
│  │  GetCulture(Name) → FCulturePtr                                   │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 6: コンテナアロケータポリシー

### FDefaultAllocator

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      FDefaultAllocator                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  定義: using FDefaultAllocator = TSizedDefaultAllocator<32>;           │
│                                                                         │
│  【特性】                                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  SizeType                  = int32 (32ビット)                     │ │
│  │  IsZeroConstruct           = true                                 │ │
│  │  SupportsElementAlignment  = true                                 │ │
│  │  SupportsSlackTracking     = true                                 │ │
│  │  GetInitialCapacity        = 0                                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### TSizedDefaultAllocator / TSizedHeapAllocator

```
┌─────────────────────────────────────────────────────────────────────────┐
│                TSizedDefaultAllocator テンプレート                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  template<int IndexSize>                                               │
│  class TSizedDefaultAllocator : public TSizedHeapAllocator<IndexSize>  │
│                                                                         │
│  【IndexSize と SizeType のマッピング】                                 │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  IndexSize = 8   → SizeType = int8                                │ │
│  │  IndexSize = 16  → SizeType = int16                               │ │
│  │  IndexSize = 32  → SizeType = int32                               │ │
│  │  IndexSize = 64  → SizeType = int64                               │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### TInlineAllocator

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   TInlineAllocator テンプレート                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  template<uint32 NumInlineElements,                                    │
│           typename SecondaryAllocator = FDefaultAllocator>             │
│  class TInlineAllocator                                                │
│                                                                         │
│  【インラインストレージ】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  alignas(ElementType) uint8 InlineData[                           │ │
│  │      sizeof(ElementType) * NumInlineElements                      │ │
│  │  ]                                                                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【特性】                                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  GetInitialCapacity = NumInlineElements                           │ │
│  │  SupportsSlackTracking = true                                     │ │
│  │  SecondaryAllocator で超過分を処理                                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 7: コンテナ成長定数

### スラック成長係数

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      スラック成長係数                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【通常モード】                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  UE_CONTAINER_SLACK_GROWTH_FACTOR_NUMERATOR   = 3                 │ │
│  │  UE_CONTAINER_SLACK_GROWTH_FACTOR_DENOMINATOR = 8                 │ │
│  │                                                                   │ │
│  │  成長率: 3/8 = 37.5% スラック                                     │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【アグレッシブメモリ節約モード】                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  UE_CONTAINER_SLACK_GROWTH_FACTOR_NUMERATOR   = 1                 │ │
│  │  UE_CONTAINER_SLACK_GROWTH_FACTOR_DENOMINATOR = 4                 │ │
│  │                                                                   │ │
│  │  成長率: 1/4 = 25% スラック                                       │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### DefaultCalculateSlackGrow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   DefaultCalculateSlackGrow                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【定数 (通常モード)】                                                  │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FirstGrow    = 4    // 最初の成長時の要素数                      │ │
│  │  ConstantGrow = 16   // 定数加算分                                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【定数 (アグレッシブモード)】                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FirstGrow    = 1    // 最小限の成長                              │ │
│  │  ConstantGrow = 0    // 定数加算なし                              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【計算式】                                                             │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Grow = NewMax + (3 * NewMax / 8) + 16                            │ │
│  │       = NewMax * 1.375 + 16  (通常モード)                         │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### DefaultCalculateSlackShrink

```
┌─────────────────────────────────────────────────────────────────────────┐
│                  DefaultCalculateSlackShrink                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【縮小条件】                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  条件1: CurrentSlackBytes >= 16384  (16KB 以上の未使用バイト)     │ │
│  │  条件2: 3 * NewMax < 2 * CurrentMax (50%以上が未使用)             │ │
│  │  条件3: CurrentSlackElements > 64   (64要素以上のスラック)        │ │
│  │                                                                   │ │
│  │  すべての条件を満たした場合のみ縮小                               │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 初期割り当て制御

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     初期割り当て制御                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  CONTAINER_INITIAL_ALLOC_ZERO_SLACK = 1  (デフォルト有効)              │
│                                                                         │
│  有効時: 初回割り当て (CurrentMax=0) では                              │
│         スラックなしで正確に NewMax を割り当て                         │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 8: ハッシュテーブル・Set定数

### Set アロケータデフォルト

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   Set アロケータデフォルト                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  DEFAULT_NUMBER_OF_ELEMENTS_PER_HASH_BUCKET = 2                        │
│  DEFAULT_BASE_NUMBER_OF_HASH_BUCKETS        = 8                        │
│  DEFAULT_MIN_NUMBER_OF_HASHED_ELEMENTS      = 4                        │
│                                                                         │
│  【ハッシュバケット数計算】                                             │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  if (NumHashedElements >= 4) {                                    │ │
│  │      return RoundUpToPowerOfTwo(NumHashedElements / 2 + 8);       │ │
│  │  } else {                                                         │ │
│  │      return 1;                                                    │ │
│  │  }                                                                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### CompactHashTable 型サイズ

```
┌─────────────────────────────────────────────────────────────────────────┐
│                  CompactHashTable 型サイズ                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【GetTypeSize(IndexCount) 計算】                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  IndexCount ≤ 255      → 1 バイト (uint8)                         │ │
│  │  IndexCount ≤ 65535    → 2 バイト (uint16)                        │ │
│  │  IndexCount > 65535    → 4 バイト (uint32)                        │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【最小ハッシュテーブルサイズ】                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  要素数 < 8  →  4 ハッシュスロット                                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 9: SparseArray・BitArray実装

### TBitArray 定数

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      TBitArray 定数                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  NumBitsPerDWORD        = 32   // 1ワードあたりのビット数              │
│  NumBitsPerDWORDLogTwo  = 5    // log2(32)                             │
│                                                                         │
│  【デフォルトアロケータ】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FDefaultBitArrayAllocator = TInlineAllocator<4>                  │ │
│  │                                                                   │ │
│  │  4 インライン DWORD = 128 ビットのインラインストレージ            │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【ビット操作】                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  ワードインデックス: BitIndex >> 5  (32で割る)                    │ │
│  │  ビットマスク:       1 << (BitIndex & 31)  (32で剰余)             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### TSparseArray 実装

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    TSparseArray 実装                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【要素ユニオン】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  union TSparseArrayElementOrFreeListLink<ElementType> {           │ │
│  │      ElementType ElementData;                                     │ │
│  │      struct {                                                     │ │
│  │          int32 PrevFreeIndex;  // フリーリストの前リンク          │ │
│  │          int32 NextFreeIndex;  // フリーリストの次リンク          │ │
│  │      };                                                           │ │
│  │  };                                                               │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【内部状態】                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FirstFreeIndex  = -1   // フリーリストの先頭 (なければ -1)       │ │
│  │  NumFreeIndices  = 0    // フリーインデックスの数                 │ │
│  │  AllocationFlags        // 割り当て済みフラグ (TBitArray)         │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【デフォルトアロケータ】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FDefaultSparseArrayAllocator:                                    │ │
│  │    要素アロケータ:   FDefaultAllocator (ヒープ)                   │ │
│  │    BitArray アロケータ: FDefaultBitArrayAllocator (4 DWORD インライン)│
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 10: 非同期タスクシステム

### EAsyncExecution 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    EAsyncExecution 列挙型                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  TaskGraph           // タスクグラフで実行 (短時間タスク向け)          │
│  TaskGraphMainThread // メインスレッドでタスクグラフ経由実行           │
│  TaskGraphMainTick   // メインスレッドの Ticker で実行                 │
│  Thread              // 別スレッドで実行 (マルチスレッド対応時)        │
│  ThreadIfForkSafe    // フォーク対応スレッドで実行                     │
│  ThreadPool          // グローバルキュースレッドプールで実行           │
│  LargeThreadPool     // 大規模スレッドプール (WITH_EDITOR のみ)        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FAsyncTask 定数

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      FAsyncTask 定数                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【スレッド命名パターン】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  "TAsync %d"        // 非同期タスクスレッド                       │ │
│  │  "TAsyncThread %d"  // AsyncThread 用スレッド                     │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【スレッドインデックス】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FAsyncThreadIndex::GetNext()  // FThreadSafeCounter でインクリメント│
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 11: スレッドプールシステム

### EQueuedWorkPriority 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                  EQueuedWorkPriority 列挙型                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Blocking = 0   // 最高優先度 (ブロッキング)                           │
│  Highest  = 1   // 最高                                                │
│  High     = 2   // 高                                                  │
│  Normal   = 3   // 通常 (デフォルト)                                   │
│  Low      = 4   // 低                                                  │
│  Lowest   = 5   // 最低                                                │
│  Count    = 6   // 列挙数                                              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### スレッドプール定数

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    スレッドプール定数                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【デフォルトスタックサイズ】                                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  32 * 1024 = 32 KB                                                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【グローバルスレッドプール】                                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  GThreadPool                   // 標準スレッドプール              │ │
│  │  GIOThreadPool                 // I/O 操作用プール                │ │
│  │  GBackgroundPriorityThreadPool // バックグラウンド優先度プール    │ │
│  │  GLargeThreadPool              // 大規模プール (WITH_EDITOR)      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【優先度キュー】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  TInlineAllocator<6>  // 6 優先度バケット                         │ │
│  │  FirstNonEmptyQueueIndex  // 最初の非空キューインデックス追跡     │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 12: タスクグラフシステム

### ENamedThreads 定数

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    ENamedThreads 定数                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【名前付きスレッドインデックス】                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  RHIThread              = 0                                       │ │
│  │  GameThread             = 1                                       │ │
│  │  ActualRenderingThread  = 2  (GameThread + 1)                     │ │
│  │  AnyThread              = 0xFF  (任意/不明スレッド)               │ │
│  │  UnusedAnchor           = -1                                      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【キュー構成】                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  MainQueue        = 0x000  (ビット 0-7)                           │ │
│  │  LocalQueue       = 0x100  (ビット 8)                             │ │
│  │  NumQueues        = 2                                             │ │
│  │  ThreadIndexMask  = 0xFF                                          │ │
│  │  QueueIndexMask   = 0x100                                         │ │
│  │  QueueIndexShift  = 8                                             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【タスク優先度】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  NormalTaskPriority = 0x000  (ビット 9)                           │ │
│  │  HighTaskPriority   = 0x200                                       │ │
│  │  NumTaskPriorities  = 2                                           │ │
│  │  TaskPriorityMask   = 0x200                                       │ │
│  │  TaskPriorityShift  = 9                                           │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【スレッド優先度】                                                     │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  NormalThreadPriority     = 0x000  (ビット 10-11)                 │ │
│  │  HighThreadPriority       = 0x400                                 │ │
│  │  BackgroundThreadPriority = 0x800                                 │ │
│  │  NumThreadPriorities      = 3                                     │ │
│  │  ThreadPriorityMask       = 0xC00                                 │ │
│  │  ThreadPriorityShift      = 10                                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FGraphEvent 定数

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     FGraphEvent 定数                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【FGraphEventRef 型】                                                  │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  using FGraphEventRef = TRefCountPtr<FBaseGraphTask>              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【インライン配列容量】                                                 │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FGraphEventArray = TArray<FGraphEventRef, TInlineAllocator<4>>   │ │
│  │                                                                   │ │
│  │  前提条件配列: 4 イベントをインライン格納                         │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【アロケータ】                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  TLockFreeFixedSizeAllocator_TLSCache<                            │ │
│  │      sizeof(FGraphEventImpl),                                     │ │
│  │      PLATFORM_CACHE_LINE_SIZE                                     │ │
│  │  >                                                                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 13: ParallelForシステム

### EParallelForFlags 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   EParallelForFlags 列挙型                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  None               = 0   // フラグなし                                │
│  ForceSingleThread  = 1   // シングルスレッド強制                      │
│  Unbalanced         = 2   // 動的ワークスティーリング使用              │
│  PumpRenderingThread = 4  // レンダリングスレッドをポンプ              │
│  BackgroundPriority = 8   // バックグラウンド優先度                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### ParallelFor バッチ計算

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   ParallelFor バッチ計算                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【バッチサイズ計算アルゴリズム】                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Div を 6 から 1 までループ:                                      │ │
│  │    BatchSize = DivideAndRoundUp(Num, NumWorkers * Div)            │ │
│  │                                                                   │ │
│  │  条件: Num >= (NumWorkers * Div) かつ NumBatches >= NumWorkers    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【ワーカー数計算】                                                     │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Min(                                                             │ │
│  │      FScheduler::Get().GetNumWorkers(),                           │ │
│  │      (Num + MinBatchSize/2) / MinBatchSize                        │ │
│  │  )                                                                │ │
│  │                                                                   │ │
│  │  名前付きスレッドなら +1 (メインスレッドも参加)                   │ │
│  │  上限: NumberOfCoresIncludingHyperthreads()                       │ │
│  │  下限: 1                                                          │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【データ構造アライメント】                                             │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  FParallelForData: alignas(PLATFORM_CACHE_LINE_SIZE)              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### ローカルキュー構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     ローカルキュー構成                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【アイテム容量】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  通常ビルド:                                                      │ │
│  │    LOCALQUEUEREGISTRYDEFAULTS_MAX_ITEMCOUNT = 1024                │ │
│  │                                                                   │ │
│  │  アグレッシブメモリ節約:                                          │ │
│  │    LOCALQUEUEREGISTRYDEFAULTS_MAX_ITEMCOUNT = 512                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【最大ローカルキュー数】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  LOCALQUEUEREGISTRYDEFAULTS_MAX_LOCALQUEUES = 1024                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【スロット状態】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Free  = 0   // エンキュー可能                                    │ │
│  │  Taken = 1   // 他スレッドがスティーリング中                      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## セクション 14: 低レベルスレッディングプリミティブ

### LowLevelTasks::ETaskPriority 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                LowLevelTasks::ETaskPriority 列挙型                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【フォアグラウンド優先度】                                             │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  High    = 0   // フォアグラウンド高                              │ │
│  │  Normal  = 1   // フォアグラウンド通常                            │ │
│  │  Default = Normal                                                 │ │
│  │  ForegroundCount = 2                                              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【バックグラウンド優先度】                                             │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  BackgroundHigh   = 2                                             │ │
│  │  BackgroundNormal = 3                                             │ │
│  │  BackgroundLow    = 4                                             │ │
│  │  Count = 5                                                        │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【特殊値】                                                             │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Inherit  // 親タスクから優先度を継承                             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### ETaskState 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     ETaskState 列挙型                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【基本フラグ (6ビット)】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  ReadyState      = 0                                              │ │
│  │  CanceledFlag    = 1   // キャンセル済み                          │ │
│  │  ScheduledFlag   = 2   // スケジュール済み                        │ │
│  │  RunningFlag     = 4   // 実行中                                  │ │
│  │  ExpeditingFlag  = 8   // 迅速化中                                │ │
│  │  ExpeditedFlag   = 16  // 迅速化完了                              │ │
│  │  CompletedFlag   = 32  // 完了                                    │ │
│  │  Count           = 63  // 最大状態値                              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【複合状態】                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Ready                = 0   // 起動準備完了                       │ │
│  │  CanceledAndReady     = 1   // キャンセル済み、起動可能           │ │
│  │  Scheduled            = 2   // 実行キューイング済み               │ │
│  │  Canceled             = 3   // キャンセル済み、キューイング済み   │ │
│  │  Running              = 6   // 実行中                             │ │
│  │  CanceledAndRunning   = 7   // 実行中だがキャンセル済み           │ │
│  │  Expediting           = 14  // 迅速化中、スレッド解放中           │ │
│  │  Expedited            = 30  // 迅速化完了                         │ │
│  │  Completed            = 32  // 実行完了                           │ │
│  │  ExpeditedAndCompleted = 48 // 迅速化実行完了                     │ │
│  │  CanceledAndCompleted = 39  // キャンセル実行完了                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### ETaskFlags / ECancellationFlags 列挙型

```
┌─────────────────────────────────────────────────────────────────────────┐
│              ETaskFlags / ECancellationFlags 列挙型                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【ETaskFlags (2ビット)】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  AllowNothing      = 0                                            │ │
│  │  AllowBusyWaiting  = 1   // ビジーウェイト許可                    │ │
│  │  AllowCancellation = 2   // キャンセル許可                        │ │
│  │  AllowEverything   = 3   // すべて許可                            │ │
│  │  DefaultFlags      = AllowEverything                              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【ECancellationFlags】                                                 │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  None                  = 0                                        │ │
│  │  TryLaunchOnSuccess    = 1   // 成功時に起動試行                  │ │
│  │  PrelaunchCancellation = 2   // 事前起動キャンセル                │ │
│  │  DefaultFlags          = 3   // 両フラグ有効                      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FScheduler ワーカー構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   FScheduler ワーカー構成                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【スピンサイクル】                                                     │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  WorkerSpinCycles = 53   // パーキング前のスピン回数              │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【ワーカー待機時間配列】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  WaitTimes[8] = { 719, 991, 1361, 1237, 1597, 953, 587, 1439 }    │ │
│  │                                                                   │ │
│  │  選択: WaitTimes[WorkerId % 8]  // ワーカーIDでローテーション     │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【コンソール変数】                                                     │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  TaskGraph.UseDynamicThreadCreation  // 動的スレッド作成          │ │
│  │    デフォルト: デスクトップ=1, その他=0                           │ │
│  │                                                                   │ │
│  │  TaskGraph.UseDynamicPrioritization  // 動的優先度付け            │ │
│  │    デフォルト: 1                                                  │ │
│  │                                                                   │ │
│  │  TaskGraph.OversubscriptionRatio     // オーバーサブスクリプション│ │
│  │    デフォルト: 2.0f                                               │ │
│  │                                                                   │ │
│  │  TaskGraph.NumForegroundWorkers      // フォアグラウンドワーカー数│ │
│  │    デフォルト: 2                                                  │ │
│  │                                                                   │ │
│  │  TaskGraph.ForkedProcessMaxWorkerThreads  // フォーク時最大ワーカー│
│  │    デフォルト: 2                                                  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### ブロックアロケーション定数

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   ブロックアロケーション定数                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【FTaskGraphBlockAllocationTag】                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  BlockSize             = 64 * 1024  // 64 KB                      │ │
│  │  AllowOversizedBlocks  = false                                    │ │
│  │  RequiresAccurateSize  = false                                    │ │
│  │  InlineBlockAllocation = true                                     │ │
│  │  TagName               = "TaskGraphLinear"                        │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【FLowLevelTasksBlockAllocationTag】                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  BlockSize             = 64 * 1024  // 64 KB                      │ │
│  │  AllowOversizedBlocks  = true                                     │ │
│  │  RequiresAccurateSize  = false                                    │ │
│  │  InlineBlockAllocation = true                                     │ │
│  │  TagName               = "LowLevelTasksLinear"                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### キャッシュラインアライメント

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   キャッシュラインアライメント                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【プラットフォーム別キャッシュラインサイズ】                           │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  デフォルト (Intel/AMD):  64 バイト                               │ │
│  │  macOS (M1/M2):          128 バイト                               │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【アライメントパターン】                                               │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  alignas(PLATFORM_CACHE_LINE_SIZE)      // 単一キャッシュライン   │ │
│  │  alignas(PLATFORM_CACHE_LINE_SIZE * 2)  // 偽共有防止             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  【タスクサイズ】                                                       │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  LOWLEVEL_TASK_SIZE = PLATFORM_CACHE_LINE_SIZE                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### FTaskBase パックドデータ構造

```
┌─────────────────────────────────────────────────────────────────────────┐
│                  FTaskBase パックドデータ構造                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【FPackedData (64ビット)】                                             │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  ビット 0-5:   State (6ビット)    // タスク状態                   │ │
│  │  ビット 6-58:  DebugName (53ビット) // TCHAR* ポインタ            │ │
│  │  ビット 59-61: Priority (3ビット)  // タスク優先度                │ │
│  │  ビット 62-63: Flags (2ビット)     // タスクフラグ                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  ※ 64ビットプラットフォーム専用 (32ビットサポートなし)                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 次のパートへのリンク

- [第1部：アーキテクチャと設計思想](Platform_Abstraction_Layer_Part1.md)
- [第2部：プリプロセッサシステムと型システム](Platform_Abstraction_Layer_Part2.md)
- [第3部：HALコンポーネント詳細](Platform_Abstraction_Layer_Part3.md)
- [第4部：ビルドシステムと新規プラットフォーム追加](Platform_Abstraction_Layer_Part4.md)
- [第5部：スレッディング・クラッシュ処理・ネットワーク・文字列処理](Platform_Abstraction_Layer_Part5.md)
- [第6部：メモリアロケータ詳細ガイド](Platform_Abstraction_Layer_Part6.md)
- [第7部：LLM完全ガイド](Platform_Abstraction_Layer_Part7.md)
- [第8部：デバッグ・診断ツール](Platform_Abstraction_Layer_Part8.md)
- [第9部：プラットフォーム固有機能・システム詳細](Platform_Abstraction_Layer_Part9.md)

---

*このドキュメントはUnreal Engine 5.7のソースコードに基づいています。*
