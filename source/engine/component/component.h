//----------------------------------------------------------------------------
//! @file   component.h
//! @brief  コンポーネント基底クラス
//----------------------------------------------------------------------------
#pragma once

#include <cstdint>
#include <typeinfo>

class GameObject;

//============================================================================
//! @brief コンポーネント基底クラス
//!
//! GameObjectにアタッチして機能を追加するための基底クラス。
//! 派生クラスで具体的な機能を実装する。
//============================================================================
class Component {
public:
    virtual ~Component() = default;

    //------------------------------------------------------------------------
    //! @brief 初期化（GameObjectにアタッチされた直後に呼ばれる）
    //------------------------------------------------------------------------
    virtual void OnAttach() {}

    //------------------------------------------------------------------------
    //! @brief 終了処理（GameObjectからデタッチされる直前に呼ばれる）
    //------------------------------------------------------------------------
    virtual void OnDetach() {}

    //------------------------------------------------------------------------
    //! @brief 更新処理
    //! @param deltaTime 前フレームからの経過時間（秒）
    //------------------------------------------------------------------------
    virtual void Update([[maybe_unused]] float deltaTime) {}

    //------------------------------------------------------------------------
    //! @brief 所有者のGameObjectを取得
    //! @return 所有者のGameObject（アタッチされていない場合はnullptr）
    //------------------------------------------------------------------------
    [[nodiscard]] GameObject* GetOwner() const noexcept { return owner_; }

    //------------------------------------------------------------------------
    //! @brief コンポーネントの有効/無効を設定
    //! @param enabled 有効にする場合はtrue
    //------------------------------------------------------------------------
    void SetEnabled(bool enabled) noexcept { enabled_ = enabled; }

    //------------------------------------------------------------------------
    //! @brief コンポーネントが有効かどうか
    //! @return 有効な場合はtrue
    //------------------------------------------------------------------------
    [[nodiscard]] bool IsEnabled() const noexcept { return enabled_; }

protected:
    Component() = default;

private:
    friend class GameObject;

    GameObject* owner_ = nullptr;
    bool enabled_ = true;
};

//============================================================================
//! @brief コンポーネントの型IDを取得するテンプレート関数
//! @tparam T コンポーネント型
//! @return 型ID
//============================================================================
template<typename T>
[[nodiscard]] inline size_t GetComponentTypeId() noexcept {
    static const size_t id = typeid(T).hash_code();
    return id;
}
